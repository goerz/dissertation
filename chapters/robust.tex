% vim: ft=tex iskeyword=@,48-57,_,-,192-255,\: dictionary=bibkeys.lst,labels.lst:
\chapter{Robustness through Ensemble Optimization}
\label{chap:robust}

The numerical design of robust quantum gates must address two issues. The first
is the unwanted interaction with the environment, inducing decoherence.
In order to take decoherence effects into account, the
system must be modeled using the formalism of Liouville space, as
reviewed in chapter~\ref{chap:quantum}, and include the dominant decoherence
channels in the equations of motion.
Applying the optimal control techniques (OCT) of chapter~\ref{chap:numerics}
allows to find pathways that avoid these dominant channels and still yield
unitary quantum gates with high fidelity.
Beyond that, however, there are also imperfections, uncertainties, and
fluctuations in the classical parameters of the experimental setup: variations
in the control, or extraneous electromagnetic fields. These can be modeled
as variations of the energies and coupling strengths in the Hamiltonian. The
challenge of real-world quantum computing is to implement quantum gates that are
robust with respect to \emph{both} decoherence and macroscopic fluctuations.

This chapter, adapted from Ref.~\cite{GoerzPRA2014}, illustrates an approach for
obtaining such robust gates, for the example of a CPHASE gate on trapped Rydberg
atoms: we apply Krotov's method, section~\ref{subsec:Krotov} of
chapter~\ref{chap:numerics}, in a Liouville space formulation, and include
classical fluctuations through an ensemble approach, obtaining an optimized control
field that induces the desired gate not just under the ideal Hamiltonian, but
also Hamiltonians with varied parameters. Similar approaches have been used  in
the context of NMR spectroscopy~\cite{kobzar2004nmr,kobzar2008nmr}.


\section{Implementation of Quantum Gates with Rydberg Atoms}
\label{sec:RydbergImplemenation}

Rydberg states of trapped neutral atoms provide an attractive platform for
the realization of quantum information processing. The qubit is encoded in two
hyperfine states of the electronic ground state; two atoms in these states are
effectively non-interacting and well-isolated from the environment.
Using a focused laser beam, the atoms may be excited to a Rydberg
state with high principal quantum number. When both atoms are in the Rydberg
state, they feel a strong dipole-dipole interaction~\cite{SaffmanRMP2010}.
Thus, by exciting to the Rydberg state, the interaction between two relatively
distant atoms may be switched on and off, generating entanglement and allowing
the implementation of a quantum gate~\cite{WilkPRL10,IsenhowerPRL10}.

Arrays of trapped neutral atoms have been realized in optical
lattices with single site occupancy~\cite{DePuePRL1999,BergaminiJOSAB2004},
\index{optical lattice}%
optical tweezers~\cite{GaetanNatPhys2009}, or on atom
chips~\cite{whitlock2009two}. Atoms can be kept at a well-defined relative
distance and be addressed individually~\cite{nelson2007imaging,
bakr2009quantum,kruse2010reconfigurable,
weitenberg2011single}. Therefore, they have the potential to provide a scalable
architecture for quantum computing, if fast, high-fidelity quantum gates can be
implemented.

The dipole-dipole interaction between two atoms in the Rydberg state, shifting
the energy of the two-atom state $\Ket{rr}$ by the interaction energy $u$,
results in a blockade effect~\cite{UrbanNatPhys09,GaetanNatPhys2009}.
If $u$ is significantly larger than the energy of a laser tuned to the
transition $\Ket{0} \rightarrow \Ket{r}$ of the atom, the laser will be far
off-resonant for reaching \Ket{rr}. Thus, exciting one atom to \Ket{r} blocks
the second atom from being excited. If the laser energy is much larger than
$u$, the blockade may be broken, as the transition to \Ket{rr} is now only
weakly detuned.
\index{Rydberg blockade}

Both in the blockade and the non-blockade regime, there are proposals for the
implementation of quantum gates~\cite{JakschPRL00}.
Outside the blockade regime, single-site addressability of the atoms is not
required. Exciting the atoms to the \Ket{rr} state for a duration of $T$,
a two-qubit phase of $\gamma = u T$ is generated.
However, excitation to the \Ket{rr} state can induce atomic motion, limiting the
fidelity. Using optimal control, the motional degree of freedom can be restored;
it has been shown that errors on the order of $10^{-3}$ are
attainable~\cite{GoerzJPB11,murphy2011towards}.


\begin{figure}[tb]
  \centering
  \begin{tabular}{rcrcrcr}
             & $\pi$-pulse   &                & $2\pi$-pulse  &               & $\pi$-pulse   &             \\
             &  (left)       &                &  (right)      &               &  (left)       &             \\
  $\Ket{00}$ & $\rightarrow$ & $\ii\Ket{r0}$  & $\rightarrow$ & $\ii\Ket{r0}$ & $\rightarrow$ & $-\Ket{00}$ \\
  $\Ket{10}$ & $\rightarrow$ & $   \Ket{10}$  & $\rightarrow$ & $  -\Ket{10}$ & $\rightarrow$ & $-\Ket{10}$ \\
  $\Ket{01}$ & $\rightarrow$ & $\ii\Ket{r1}$  & $\rightarrow$ & $\ii\Ket{r1}$ & $\rightarrow$ & $-\Ket{01}$ \\
  $\Ket{11}$ & $\rightarrow$ & $   \Ket{11}$  & $\rightarrow$ & $   \Ket{11}$ & $\rightarrow$ & $ \Ket{11}$ \\
  \end{tabular}
  \caption{Scheme for the implementation of a CPHASE gate with individually
  addressable atoms in the Rydberg blockade regime
\index{Rydberg gate}%
  }
  \label{fig:jaksch_zoller}
\end{figure}
Here, we focus on the blockade regime and assume that the atoms can be
individually addressed. A CPHASE gate can then be implemented by the scheme
shown in Fig.~\ref{fig:jaksch_zoller}~\cite{JakschPRL00}.
First, a $\pi$-pulse is applied only to the left atom, transferring population
from \Ket{0} to \Ket{r}, with a phase factor of $\ee^{\ii \frac{\pi}{2}}$, see
appendix~\ref{AppendixRabi}. The $\Ket{1}$ level is completely isolated and is
thus not affected by the pulse. The second step is a $2\pi$-pulse on the right
atom. Because of the Rydberg blockade, the $\Ket{r0}$ and $\Ket{r1}$ state are
unaffected, whereas $\Ket{10} \rightarrow \ii \Ket{1r} \rightarrow -\Ket{10}$.
Lastly, another $\pi$-pulse on the left atom completes the gate.

While conceptually, the available schemes provide a clear recipe for the
implementation of quantum gates, their experimental realization holds
considerable challenges.
While the dipole-dipole interaction between two atoms in the Rydberg states
potentially allows for fast gates, there are a number of intrinsic and technical
sources of error that can restrict both the achieved fidelity and the speed of
operation.

The transition $\Ket{0} \rightarrow \Ket{r}$ is not directly accessible by
available laser frequencies. Therefore, it must be implemented as a two-photon
transition via an intermediary level. This complicates the implementation of the
necessary $\pi$- and $2\pi$-pulses for the gate scheme in
Fig.~\ref{fig:jaksch_zoller} considerably. Loss from the intermediary level has
been identified as one of the primary technical challenges in the implementation
of a gate, together with fluctuations in pulse amplitude, and fluctuations in
the Rydberg level, which is highly sensitive to external electromagnetic
fields~\cite{zhang2012fidelity}.

In section~\ref{sec:RydAnalytic}, we consider several analytic pulse sequences
that implement the gate scheme via an intermediary level, realizing effective
Rabi-pulses either via adiabatic elimination~\cite{BrionJPA2007} or a STIRAP
process~\cite{RaoPRA2014}, and systematically analyze their robustness with
respect to the primary fluctuating parameters. Even in the best case, we find
that gate fidelities drop by several percent over a realistic range of
fluctuations. Moreover, gate durations of at least \SI{800}{ns} are required.
In related existing proposals to mitigate the effects of intrinsic
errors in Rydberg gates using adiabatic passage
techniques~\cite{gaubatz1990population}, the resulting pulse sequences typically
also result in relatively long gate times of $\mu$s or
longer~\cite{moller2008quantum,beterov2013quantum}.

We therefore turn to optimal control, using Krotov's method presented in
chapter~\ref{chap:numerics}, applied to the density matrix formalism in order to
take into account spontaneous emission from the intermediary level. Secondly, we
obtain robustness with respect to
fluctuations in pulse amplitude, expressed through the dipole moment, and
Rydberg energies, expressed through the two-photon detuning.
The results of the optimal control yield
systematically higher gate fidelities than all analytic approaches, showing
improvement of an order of magnitude to reach gate errors of order 10$^{-4}$
for equivalent gate times.  Most importantly, optimal control can deliver gate
performance that is also extremely robust with respect to experimental
fluctuations, with the gate error staying below or at the order of $10^{-3}$
even for large fluctuations, i.e.\ below the quantum correction limit
\cite{aliferis2008err}. Lastly, optimal control also allows to address the issue
of gate duration. By systematically decreasing the gate time until the
optimization no longer yields a gate of sufficiently high
fidelity~\cite{CanevaPRL09}, a ``quantum speed limit'' for performing the
gate~\cite{GiovannettiPRA03} can be determined.
Compared to the analytical solutions, using optimal control we can significantly
shorten the total gate duration, to $\SI{\sim 100}{ns}$, without
loss in either robustness or fidelity.

%The resulting numerical
%pulse spectra are surprisingly simple and allow the
%error threshold for fault tolerant computation to be reached at the price of a small
%increase in pulse complexity relative to the analytic sequences.
%A key insight that emerges from the optimal control calculations is that the use
%of a two-photon Rydberg excitation with none of the restrictions on pulse
%timings exhibited by the analytic model pulse sequences, introduces the
%possibility
%of a pathway interference in the spectral domain, which leads to a significant
%enhancement of the overall gate fidelities.

\section{Model}
\label{sec:RydModel}

\begin{figure}[tb]
    \centering\includegraphics{RydRobust_1q_levels}
  \caption{%
    Level scheme for a single atom.}
  \label{fig:RydRobust_1q_levels}
\end{figure}
We consider two cesium atoms trapped in an optical lattice with
single-site addressability.
The qubit states are encoded in hyperfine levels of the ground state,
$\ket{0} =\ket{6\,^2S_{1/2}, F=3}$,
$\ket{1} =\ket{6\,^2S_{1/2}, F=4}$.

For technical reasons, the Rydberg level, here
$\ket{r}=\ket{50D_{3/2}}$, is accessed by a two-photon transition via an
intermediate state~\cite{GaetanNatPhys2009,WilkPRL10}, $\ket{i}=\ket{7P_{3/2}}$.
In the basis $\{\Ket{0},\Ket{1},\Ket{i},\Ket{r}\}$,
the Hamiltonian for a single atom, using a two-photon
rotating-wave approximation, see appendix~\ref{AppendixRWA}, reads
\begin{equation}
  \label{eq:Rydberg_H_1q}
  \Op{H}_\text{1q} =
  \begin{pmatrix}
      0 & 0 & \Omega_B(t) & 0 \\
      0 & E_1 & 0 & 0 \\
      \Omega_B(t) & 0 & \Delta_1 & \Omega_R(t) \\
      0 & 0 & \Omega_R(t) & \Delta_2
  \end{pmatrix}\,,
\end{equation}
where $\Omega_B (t), \Omega_R (t)$ are the Rabi frequencies of the `blue' and
`red' pulses, $\Omega_\alpha=\frac{1}{2}\mu^\alpha_{ij}E(t)$,
cf.\ Fig.~\ref{fig:RydRobust_1q_levels}, and $\Delta_1, \Delta_2$ are the
one-photon and two-photon detunings.
The two atoms are kept at a distance of
\SI{5}{\micro\meter} such that their interaction is negligible except when both
atoms are in the Rydberg state.
The Hamiltonian for the two atoms, including their Rydberg
interaction, is written as
\begin{equation}
  \label{eq:2q_ham}
  \Op{H}_{2q} = \Op{H}_{1q} \otimes \openone + \openone \otimes \Op{H}_{1q}
  - u \Ket{rr}\langle rr|\,,
\end{equation}
with interaction energy $u$. The parameters are summarized in
Table~\ref{table:params}.
\begin{table}
  \centering
  \begin{tabular}{llcrl} \toprule
  Single-Photon Detuning      & $\Delta_1$ & $=$ & 1.273& GHz \\
  Two-Photon Detuning         & $\Delta_2$ & $=$ &  0   &     \\
  Qubit Energy                & $E_1$      & $=$ & 9.100& GHz \\
  Interaction Energy          & $u$        & $=$ & 57.26& MHz \\
  Intermediate State Lifetime & $\tau$     & $=$ & 150.0& ns  \\
  \bottomrule
  \end{tabular}
  \caption{Rydberg atom system parameters}
  \label{table:params}
\end{table}
Rabi frequencies of $\Omega_B = \SI{171.5}{MHz}$
and $\Omega_R = \SI{148.4}{MHz}$ have been implemented for this system and
values up to \SI{\sim 250}{MHz} are expected to be experimentally
feasible~\cite{TedRyd}.
Note that we can restrict our model to a single $m_J$-sublevel of the
Rydberg state (e.g., $m_J=5/2$) by choice of laser polarization, such that
the shift due to the interaction $u$ is insensitive to magnetic field~\cite{SaffmanRMP2010}
and may then be ignored.
In order clarify the physics of the alternate excitation path to the excited
state, we have approximated the intermediate state as a single
level. In practice, since the alternate excitation path is
approximately resonant with the intermediate state, it would be desirable to
also include details of the intermediate state hyperfine
structure in the control optimization. This might affect the optimal
laser detuning but will not cause any qualitative changes in the
results obtained here.

The intermediate level undergoes spontaneous decay to the ground state. Thus,
the full dynamics must be described by a master
equation in Lindblad form,
\begin{equation}
  \label{eq:master}
  \frac{\partial }{\partial t}\Op{\rho}(t)
  = -\ii [\Op H_{2q}(t),\Op{\rho}(t)] + \mathcal{L}_D(\Op{\rho}(t))\,.
\end{equation}
$\mathcal{L}_D$ is the dissipator for the spontaneous decay of each atom,
\begin{equation}
  \label{eq:dissipator_rydberg}
  \mathcal L_D(\Op\rho) = \frac{1}{\tau} \sum_{i=1,2} \left(
    \Op{A}_i \Op{\rho} \Op{A}_i^\dagger
    - \frac{1}{2} \left\{\Op{A}_i^\dagger \Op{A}_i, \Op{\rho} \right\}
    \right)\,,
\end{equation}
with $\Op{A}_1 = \KetBra{0}{i} \otimes \unity$,
$\Op{A}_2 = \unity \otimes \KetBra{0}{i}$, and $\tau$ the lifetime
of state $\Ket{i}$.

Resonant excitation of both atoms to the Rydberg state leads to an
acceleration of the atoms towards each other due to the dependence of the Rydberg
interaction strength on interatomic separation~\cite{JakschPRL00}.
The minimum gate duration
is then determined either by the inverse of the interaction, $u$, or by
the period of the atomic motion in the trap~\cite{GoerzJPB11}.
The gate duration may be limited further by the inverse of the
experimentally realizable Rabi frequencies.

We consider here the Rydberg blockade regime which avoids resonant
excitation into $\Ket{rr}$. It corresponds to
\begin{equation}
  \label{eq:blockade}
  \Omega_{\eff}\ll u,
\end{equation}
\index{Rydberg blockade}%
where~\cite{ShoreBook11}
\begin{equation}
  \Omega_{\eff} \approx \frac{\Omega_R\Omega_B}{2\Delta_1}\,.
\end{equation}
\index{Rabi oscillation!two-photon}%
The original proposal of the Rydberg gate~\cite{JakschPRL00} in this regime
requires the atoms to be individually addressable, and employs the pulse
sequence shown in Fig.~\ref{fig:jaksch_zoller}.  If the qubits are initially in
$\Ket{00}$, a non-local phase is accumulated during the middle pulse because of
the detuning of level $\Ket{rr}$ due to the interaction, $u$, and we can thus
execute a CPHASE gate. This is in principle feasible with the experimental setup
of
Ref.~\cite{nelson2007imaging}.

We quantify success in terms of the gate error defined as $1-F_{\avg}$, where
$F_{\avg}$ is the average gate fidelity, Eq.~\eqref{eq:Favg_2q_unitary}.
The fidelity is calculated with respect to the target CPHASE gate, for $\Op{U}$,
the projection of the time evolution operator onto the logical subspace
($\Op{U}$ is unitary if and only if there is no loss from that subspace at final
time $T$).

\section{Analytic pulse sequences}
\label{sec:RydAnalytic}

When a resonant two-photon transition is employed via an
intermediate level, the two-level system
$\{\Ket{0},\Ket{r}\}$ for one atom in the original
proposal~\cite{JakschPRL00} is
replaced by $\{\Ket{0},\Ket{i},\Ket{r}\}$. The $\pi$ and $2\pi$ population
flips can then be realized either with
two simultaneous pulses, namely $\Omega_B$ connecting
$\Ket{0}$ and $\Ket{i}$ and $\Omega_R$ connecting $\Ket{i}$
and $\Ket{r}$; or via a STIRAP process~\cite{RaoPRA2014}, where $\Omega_R$
acts as a ``Stokes'' pulse, preceding but overlapping $\Omega_B$, the ``pump''
pulse. Both methods may be combined in a mixed scheme, where a STIRAP sequence
is used for the $\pi$ flip acting on the left atom, while the $2\pi$ flip on the right
atom is realized using simultaneous pulses.
The pulse schemes should avoid putting any population in the intermediary state;
if this condition is satisfied there are no relevant dissipative effects and the dynamics
can be described in Hilbert space, using the time-dependent Schrödinger equation
in place of Eq.~\eqref{eq:master}.
The following sections discuss the merits and drawbacks of all three approaches,
and numerically analyze the robustness with respect to pulse timing,
fluctuations of the Rydberg level, and fluctuations of the pulse amplitude.
We find that the mixed scheme is the most robust of these analytic approaches,
due to its selective use of STIRAP on the control qubit only.  However, all
STIRAP based schemes are found to require either large pulse
amplitudes or exceedingly long
pulse times.

\subsection{Sequence of three simultaneous pulse pairs}
\label{subsec:RydJZ}

We first consider the realization of all population transfers using simultaneous
pulse pairs. The pulses are of Blackman shape,
\begin{equation}
  \label{eq:blackman}
  \Omega(t) = \frac{E_0}{2}\left(1 - a - \cos\left(\frac{2\pi t}{T}\right)
  + a\cos\left(\frac{4\pi t}{T}\right)\right)\,,
\end{equation}
\index{Blackman shape}%
with $a = 0.16$ and $E_0$ the peak amplitude. This pulse shape is essentially
identical to a Gaussian centered at $T/2$ with a width of $\sigma = T/6$, but,
unlike the Gaussian, is exactly zero at $t=0$ and $t=T$. Other pulse shapes are
possible.

\begin{figure}[tb]
    \centering\includegraphics{blackman_seq_pulses}
  \caption{%
    Three sequential Blackman pulse pairs implementing a CPHASE gate.}
  \label{fig:jz_pulses}
\end{figure}
A pulse sequence that realizes the two $\pi$-flips on the left atom and one
$2\pi$-flip on the right atom is shown in Fig.~\ref{fig:jz_pulses}. Due to the
large single photon detuning of \SI{1.3}{GHz}, the intermediate level can be
adiabatically eliminated. This places a restriction on the pulse amplitude,
\begin{equation}
    \Omega_B, \Omega_R \ll \Delta_1\,.
\end{equation}
\index{adiabatic elimination}%
The $2\pi$ pulse is more stringently restricted by the blockade condition in
Eq.~\eqref{eq:blockade}. With the pulse duration being inversely proportional to
the pulse amplitude, both effects result in a quantum speed limit.

\begin{figure}[tb]
    \centering\includegraphics{rydberg_qsl}
  \caption{%
    Quantum speed limit for the Rydberg gate using simultaneous
    Blackman pulse pairs. The time window is only that of the center
    $2 \pi$ pulse in the scheme.
    As a measure of the breakdown of the Rydberg blockade,
    the maximum population in the $\Ket{rr}$ state during that pulse is shown,
    as well as the maximum population in the $\Ket{01}$ state, as a measure of
    the breakdown of the adiabatic elimination of the intermediate level.
    Finally, we show the total gate error obtained when combining the center
    $2\pi$ pulse of the given duration with two \SI{50}{ns} $\pi$ pulses on the left
    atom.
  }
  \label{fig:QSL}
\end{figure}
Quantitatively, the limitations are illustrated in
Fig.~\ref{fig:QSL} which shows the gate error (black solid line) vs.\ duration
of the middle $2\pi$ pulse, using
a duration of \SI{50}{ns} for the initial and final $\pi$ pulse.
The breakdown of adiabatic elimination becomes apparent in the peak
population of the $\Ket{0i}$ state (blue short-dashed line), whereas a
breaking of the Rydberg blockade is observed in
the peak population in the $\Ket{rr}$ state (orange long-dashed line).
Gate errors below $10^{-3}$ are only reached
for pulse durations of \SI{>=800}{ns}.
The gate time is dominated by the central $2\pi$ pulse, which must be
sufficiently weak to not break the Rydberg blockade. Already, the pulse
amplitude is remarkably close to the interaction energy, pushing the limits of
condition (\ref{eq:blockade}).
Note that the choice of identical
peak Rabi frequencies for the red and blue laser,
$\Omega_{B,\max}=\Omega_{R,\max}$, is the only ratio
possible to guarantee complete population inversion in a three-level
system using simultaneous pulses when the intermediate level is adiabatically
eliminated~\cite{ShoreBook11}.

\begin{figure}[tb]
    \centering\includegraphics{jaksch_zoller_pop_phase}
  \caption{%
    Population and phase dynamics using the simultaneous pulses
    shown in Fig.~\ref{fig:jz_pulses}. Since the population in the intermediary
    states $\Ket{1i}$, $\Ket{i1}$, $\Ket{i0}$ are effectively zero throughout,
    there are not included in the phase dynamics, panels (d-f).
    }
  \label{fig:jz_dynam}
\end{figure}
Population and phase dynamics obtained with simultaneous red and blue
pulses are shown in Fig.~\ref{fig:jz_dynam}. As described in
section~\ref{sec:RydModel}, the population undergoes a $\pi$ Rabi cycle
on the left atom, followed by a $2\pi$ pulse
on the right atom, followed by a $\pi$ pulse on the left atom,
cf. Fig.~\ref{fig:jz_dynam} (a,b,c). The intermediate levels (red long-dashed
lines) receive almost no population. Thus,
for this time scale, spontaneous decay is not an issue.  As can be
seen from Fig.~\ref{fig:jz_dynam} (f),
the non-local phase is accumulated in the $\Ket{00}$ state entirely
during the central $2\pi$ pulse. Although the Rydberg blockade
is not broken, and the population remains
in $\Ket{r0}$, the state accumulates an additional phase due to the
detuned pulse driving the transition out of $\Ket{r0}$. This additional
phase is critical for the success of the gate.

\subsection{Sequence of STIRAP pulse pairs}
\label{subsec:RydStirap}

STIRAP is a popular scheme to achieve population transfer in
three-level systems, avoiding population in the intermediate level at all times
\cite{BergmannRMP98}.
\index{STIRAP}%
It is based on adiabatically following a
dynamic dark state that does not contain an $\Ket{i}$-component.
In our setup, the scheme for transferring population from $\Ket{0}$ to
$\Ket{r}$ is realized by first switching on the red laser, acting as
a ``Stokes'' pulse, followed by the blue laser, acting as the ``pump'' pulse.
The two pulses must overlap, but the process is robust with respect to the
laser amplitude and the exact overlap of the pulses, as long as the
condition for adiabatic following, roughly given
by~\cite{BergmannRMP98}
\begin{equation}
  \label{eq:stirap}
  \Omega_B \Delta\tau,
  \Omega_R \Delta\tau \gg
  10
\end{equation}
is met, where $\Delta\tau$ is the time for
which the pulses overlap. Thus, for short
pulses, large amplitudes are required.  However, for a Rydberg gate,
the blockade condition, Eq.~\eqref{eq:blockade}, also needs to be fulfilled, limiting
the maximum Rabi frequency.
Therefore STIRAP can only employ comparatively long pulses for the center $2\pi$
Rabi flip on the right atom.

\begin{figure}[tb]
    \centering\includegraphics{stirap_blockade}
  \caption{%
    Breakdown of the Rydberg blockade for STIRAP: Only
    long gate durations allow for amplitudes that are sufficiently
    large to ensure adiabaticity in STIRAP while being small enough not
    to break the Rydberg blockade (lower panel).The amplitude of the two central
    pulse pairs are systematically scanned while the amplitude of the first and
    last pulse pairs are kept constant.
  }
  \label{fig:blockade_stirap}
\end{figure}
In order to quantify the violation of the blockade condition,
we define the ``blockade efficiency'' as
\begin{equation}
  B = \max(P_{1r}) - \frac{1}{2}P_{1r}(T) -
\left(\max(P_{rr}) - \frac{1}{2}P_{rr}(T)\right)\,,
\end{equation}
where $T$ is the total time of the pulse sequence and $P_{1r}$ and $P_{rr}$ are
the population in $\Ket{1r}$ and $\Ket{rr}$, respectively. $B$ takes values
between zero and one, with one corresponding to a perfect blockade.
Both maximum and final-time populations appear in $B$ because in order
to have full Rabi cycling, the Rydberg level must be fully populated
(giving a maximum population of one)
and then fully depopulated (giving a final population of zero), i.e.,
considering only the maximum population does not allow for
distinguishing between $\pi$ and $2\pi$ pulses. We only obtain $B=1$ when
the population completes a $2\pi$ cycle through $\Ket{1r}$ whenever the system
begins in $\Ket{10}$, but never reaches $\Ket{rr}$ whenever the system begins in
$\Ket{00}$.
The blockade condition, Eq.~\eqref{eq:blockade}, depends on the peak
amplitude of the pulses whereas the
adiabaticity condition, Eq.~\eqref{eq:stirap},
depends on the pulses' complete Rabi angle. For short central $2\pi$ pulses
the Rabi angle will not be  sufficiently large
to satisfy the adiabaticity condition without requiring a peak
amplitude so high that it will break the blockade. This is illustrated in
Fig.~\ref{fig:blockade_stirap} (top), where
for small amplitudes both the maximum and final $\Ket{1r}$
populations rise together: the Rabi angle is less than $\pi$. Then, as the final
$\Ket{1r}$ population begins to fall
such that the adiabaticity
condition of STIRAP is better fulfilled, the blockade is broken, causing the
drop in the blockade  efficiency, concurrent with a
rise in both the maximum and final $\Ket{rr}$ populations.
In Fig.~\ref{fig:blockade_stirap} (bottom), the maximum
and final $\Ket{1r}$ populations rise together, but
$\Ket{1r}$ is now fully depopulated, thus achieving full Rabi
cycling, before breaking the
blockade. This corresponds to the area where $B \approx 1$ seen in the
graph. We do not see a rise in the maximum and final $\Ket{rr}$ population
until high peak amplitudes.

\begin{figure}[tb]
    \centering\includegraphics{stirap_pulses}
  \caption{%
    A sequence of STIRAP pulse pairs to implement the
    Rydberg CPHASE gate: While the pulses acting on the left atom
    can be made very short (limited effectively by the power of the driving
    laser), the pulses acting on the right atom need to be sufficiently long to
    avoid breaking the Rydberg blockade.
  }
  \label{fig:Stirap}
\end{figure}
A corresponding  sequence of STIRAP pulse pairs, using short pulses on the left
atom and long pulses on the right atom,  is shown in Fig.~\ref{fig:Stirap}.
In principle, the pulses on the left atom can be made arbitrarily short,
at the expense of extremely large field amplitudes. Taking into account
realistic restrictions on the available laser power, the gate time will
generally become prohibitively large.

Additionally, since the STIRAP pulses are so robust to two-photon
detuning~\cite{grigoryan2001adiabatic}, STIRAP will, to some extent, resolve the
non-resonant Rydberg levels that are not explicitly considered, leading to
unwanted population dynamics. Even if this population transfer to extraneous
levels is invertible, it will lead to undesired phase accumulation as the higher
and lower energy levels rotate with different frequencies than the rotating
frame.

\subsection{Mixed scheme: STIRAP-$\pi$-pulses and simultaneous
  $2\pi$-pulses}
\label{subsec:RydMixed}

\begin{figure}[tb]
    \centering\includegraphics{mixed_pulses}
  \caption{%
    Mixed scheme: STIRAP pulse pairs for robust population
    transfer on the left atom, and simultaneous pulses for the $2\pi$
    rotation of the right atom.
  }
  \label{fig:mixed}
\end{figure}
The primary drawbacks of the simultaneous pulses are the
unwanted population in the intermediate level for the pulses acting on
the left atom and a relatively large sensitivity of
the pulses to variations in pulse area.
On the other hand, the primary drawback
of STIRAP is the breakdown of the Rydberg blockade, which
results from employing an extremely long  pulse acting on the right
atom. This issue, however, is  not present when using STIRAP for the
pulses acting on the left atom. We therefore investigate a mixed
scheme, consisting of STIRAP pulses to drive the $\pi$ rotations on
the left atom and simultaneous pulses to drive the $2\pi$ rotation on
the right atom, cf. Fig.~\ref{fig:mixed}. By doing so we
use each method where it is most effective.
Furthermore, the pulses on the left and right atom can be overlapped
without any appreciable loss in fidelity. This is because the
pulses acting on the right atom only drive significant population
transfer during the central third of the pulses. As long as the left
atom is populated by the time the amplitude of the pulses acting on
the right atom becomes significant, the blockade is still effective. The two
STIRAP pulses acting on the left atom, that bookend the central pulses
acting on the right atom, are moved in towards the center.
In fact the pulses can be compressed
quite far: By overlapping the STIRAP pulses
with the central pulses for \SI{250}{ns} (see Fig.~\ref{fig:mixed}),
the gate duration can be
reduced from \SI{1300}{ns} to \SI{800}{ns}. The gate duration in the mixed scheme is
limited by the laser power available for driving the left atom.

\subsection{Robustness}
\label{subsec:RydRobust}

For all three variants of pulse sequences, the gate fidelity in an
actual experiment will be compromised by noise and experimental
inaccuracies. In the following, we consider three main sources of
errors: inaccuracies in timing between the pulses acting on the left and right
qubit, inaccuracies in pulse
amplitudes, and fluctuations of the Rydberg level due to, e.g., the
presence of DC electric fields~\cite{MullerQIP11}. The latter
results in a non-zero two-photon detuning.
To analyze the robustness with respect to all of these fluctuations, we
determine the expectation value of the gate fidelity under the assumption that
the timing offset, the transition dipole, and the two-photon detuning
differ from the optimal values by $\Delta_{\text{time}}$,
$\Delta_{\Omega}$, and $\Delta_{\ryd}$ drawn from a Gaussian
distribution centered at 0 of width $\sigma_{\text{time}}$, $\sigma_{\Omega}$, and
$\sigma_{\ryd}$, respectively. For the pulse amplitudes,
the variation is given in percent of the original amplitudes. The expectation
value of the avergage gate fidelity is given by
\begin{equation}
  \label{eq:meanF}
  \tilde F(\sigma_x)
  = \int  \frac{1}{\sqrt{2 \pi \sigma_x^2}}
          \ee^{-\frac{\Delta x}{2 \sigma_x^2}}
          F_{\avg}(\Delta x) \dd x,
\end{equation}
with $\sigma_{x} = \sigma_{\text{time}}, \sigma_{\Omega}, \sigma_{\ryd}$,
and $\Delta x = \Delta_{\text{time}}, \Delta_{\Omega}, \Delta_{\ryd}$, and
$F_{\avg}$ given by Eq.~\eqref{eq:Favg_2q_unitary}.
Sampling over 1000 variations of each parameter allows to evaluate the
integral in Eq.~\eqref{eq:meanF} numerically.

\begin{figure}[tb]
  \centering
  \includegraphics{robustness}
  \caption{%
    Robustness of the Rydberg gate with respect
    to Rydberg level fluctuations (top), amplitude fluctuations
    (middle), and fluctuations in the relative timing between
    pulses acting on the left and right atom. All fluctuations are
    drawn from a Gaussian distribution of width $\sigma_{\ryd}$,
    $\sigma_{\Omega}$, and $\sigma_{\text{time}}$, respectively. Note
    that the (\%) in the middle panel refers to the percent by which the
    each pulse was uniformly scaled down. For the Rydberg level,
    $\sigma_{\ryd} = \SI{150}{kHz}$ represents a $0.3\%$ variation of
    $u=\SI{57}{MHz}$.}
  \label{fig:pulserobust}
\end{figure}
Figure~\ref{fig:pulserobust} shows the resulting expectation value of the
gate fidelity vs.\ standard
deviation of the fluctuations in pulse timings, pulse amplitudes,
and energy of the Rydberg level.
The gate is found to be very robust with respect to pulse timings
and fairly robust with respect to amplitudes: only errors of more
than a few nanoseconds in timing and several per cent in amplitude
reduce the gate fidelity appreciably.
A larger sensitivity is found with respect to the position of the Rydberg level:
Fluctuations on the order of 1\% of the interaction energy $u=\SI{57}{MHz}$ reduce
the gate fidelity to around 0.5 even for the most robust scheme, and even those
on the order of 0.1\% of $u$ reduce the fidelity appreciably, cf.\ top
panel of Fig.~\ref{fig:pulserobust}. This is not surprising, since a
`wrong' energy of the Rydberg level leads to a non-zero two-photon
detuning, $\Delta_2$, and thus affects both the population
transfer for the left atom and the non-local phase accumulated during
the pulse acting on the right atom. This additional phase is by assumption
unknown and thus cannot be accounted for. Depending on the choice of the
Rydberg level, the fluctuations of the level energy may be
suppressed down to \SI{100}{kHz} or less~\cite{Saffman_pc}.
Gate fidelities of about 0.98 are then
within reach, as shown in the upper panel of Fig.~\ref{fig:pulserobust}.

Though all the schemes behave similarly with respect to variations in timing, there are
significant differences in each scheme's robustness to fluctuations in
pulse amplitude and Rydberg level energy. For inaccuracies in pulse
amplitude, cf.\ Fig.~\ref{fig:pulserobust}
(middle), the fidelity achieved with STIRAP pulses is far more
susceptible to small variations than both other schemes. This is due to the
additional phase accumulated for STIRAP during the central  pulse
acting on the right atom, caused by undesired population entering
$\Ket{ri}$, cf.\ section~\ref{subsec:RydStirap}.
Additional corrections would be required to compensate undesired phase
evolution~\cite{beterov2013quantum}.
The mixed scheme performs slightly better than the simultaneous scheme
in this respect, as the robust STIRAP pulses acting on the left atom
can achieve efficient  population transfer at a wide variety of amplitudes.
With respect to fluctuations in the energy of the Rydberg level,
in Fig~\ref{fig:pulserobust} (top) the longer a given scheme populates
$\Ket{r0}$, the less robust that scheme is. When the population is in the
detuned $\Ket{r0}$ state, it accumulates  an undesired phase, and this,
not the loss in population transfer efficiency, is the primary reason for the
drop in fidelity. The longer a scheme remains in  $\Ket{r0}$, the longer it
takes to accumulate this additional phase. The mixed scheme, which overlaps
the pulses acting on the left and right atom and thus populates
$\Ket{r0}$ for the shortest time possible, is the most robust to
fluctuations in the Rydberg level energy. This is followed by the
simultaneous scheme, which fully  populates $\Ket{r0}$ for \SI{700}{ns}, and
finally the STIRAP scheme, which fully populates $\Ket{r0}$ for \SI{4200}{ns}.
Counterintuitively, then, the schemes actually are less robust with
respect to variations in Rydberg level energy the longer they become.

\section{Optimal control}
\label{sec:RydOCT}

The use of optimal control theory (OCT) allows to obtain non-analytic pulses
that are not bound by conditions of adiabaticity, and that can realize gate
times at the quantum speed
limit~\cite{GoerzJPB11,MullerPRA11,MullerQIP11}.
Here, we extend the application of optimal control to increase the
robustness of the pulses with respect to fluctuations in amplitude and the
energy of the Rydberg level due to external fields. This is achieved by
requiring the gate fidelity, Eq.~\eqref{eq:Favg}, to be close
to one not only for the ideal
Hamiltonian $\Op{H}_0$, Eq.~\eqref{eq:2q_ham}, but also for an ensemble
of perturbed Hamiltonians $\{\Op{H}_n\}$, $n=[1,N-1]$ that sample the relevant
parameter space of variations.
Unlike in the analytical pulse schemes, the optimized control pulses will not
consist of sub-pulses, but will be completely overlapping. Therefore, an
analysis of the robustness with respect to pulse timing is not meaningful in
this context.

\subsection{Control Equations}

Since population in the intermediate state
$\Ket{i}$ should be avoided, we now perform the optimization in Liouville space, and
include spontaneous emission for the intermediate level with a lifetime of
\SI{150}{ns}~\cite{CampaniLANC1978,OrtizJQSRT1981}. The optimization functional to be
minimized reads
\begin{equation}
  J = 1 - \frac{1}{16 N} \sum_{n=0}^{N-1} \sum_{k=1}^{16}
    \mathfrak{Re}\left\{\trace\left[
      \Op O\Op\rho_{k}(0)\Op O^{\dagger}\Op\rho_{k,n}\left(T\right)
    \right]\right\}
    - \sum_{j=1}^{4} \lambda_j \int_0^T
      \frac{\left(\Delta \Omega_{j}(t)\right)^2}{S(t)}
       \dd t\,,
  \label{eq:functional}
\end{equation}
with
\begin{equation}
    \Delta \Omega_{j}(t) = \Omega_{j}^{(i+1)}(t)-\Omega_{j}^{(i)}(t)\,.
\end{equation}
\index{Krotov!Liouville space formulation}%
in iteration OCT iteration $i$.
The first part of $J$ is a final time cost that measures the Hilbert-Schmidt
overlap of the propagated states $\Op{\rho}_{k,n}(T)$ with the target states
$\Op{O}\Op{\rho}_k(0)\Op{O}^\dagger$, where $\Op{O}$ is the CPHASE gate, up to
a trivial global phase due to the natural time evolution of the $\Ket{1}$ state.
It corresponds to Eq.~\eqref{eq:JTre} in Liouville space, over all states in the
basis, and for each ensemble.
The set of $\Op{\rho}_k$ are the canonical basis elements of the two-qubit
Liouville space, $\{\Ket{i}\!\Bra{j} \} \; \forall i,j \in \{ 00, 01, 10, 11\}$.
The state $\Op{\rho}_{k,n}(T)$ is the state $\Op{\rho}_{k}(0)$ propagated under
the $n$'th ensemble Hamiltonian $\Op{H}_n$. In order for a robust gate to be
successfully implemented, the overlap must become maximal for all of the $N$
ensemble members.

The second term corresponds to Eq.~\eqref{eq:g_a_delta}, but for the four
controls $\Omega_j(t)$: the fields of the red and blue lasers for the left and
right atom, respectively. $S(t)$ is a shape function for $\Delta\Omega_j$ that
maintains smooth switch-on and switch-off of the pulses.
The gate duration $T$ is fixed for the optimization, but can
be systematically varied in order to determine the quantum speed limit. As shown
in chapter~\ref{chap:3states}, for numerical efficiency, the full basis of 16
states can be replaced by just two density matrices specifically tailored to the
optimization problem, exploiting the fact that we optimize for a diagonal
unitarity and not a general dynamical map~\cite{Goerz3States}.
The time dependent states $\Op{\rho}_{k,n}(t)$ are determined by the equation of
motion,
\begin{equation}
  \frac{\partial }{\partial t}\Op{\rho}_{k,n}(t)
  = -\frac{\ii}{\hbar} [\Op H_n(t),\Op{\rho}_{k,n}(t)]
    + \mathcal{L}_D(\Op{\rho}_{k,n}(t))\,
  \label{eq:LvN_rydberg}
\end{equation}
with $\Op{\rho}_{k,n}(t=0) = \Op{\rho}_{k}(0)$,
and $\mathcal{L}_D$ according to Eq.~\eqref{eq:dissipator_rydberg}.

For our choice of functional, the linear version of Krotov's
method~\cite{PalaoPRA03,ReichJCP12} is sufficient.
The update equation for each control is given by
Eq.~\eqref{eq:krotov_first_order_update}, but written out in Liouville space.
The inner product is new given by the Hilbert-Schmidt overlap. Since the
dissipator does not depend on the control,
\begin{equation}
  \frac{\partial \Liouville}{\partial \Omega_j} \Op{\rho}_{k,n}^{(i+1)}(t)
  =
       \left[
        \frac{\partial \Op{H}_n}{\partial \Omega_j},
        \Op{\rho}_{k,n}^{(i+1)}(t)
       \right]\,.
\end{equation}
Thus, the update equation for each pulse reads
\begin{equation}
\label{eq:update}
     \Delta\Omega_j(t) =
     \frac{S(t)}{\lambda_j} \sum_{n=0}^{N-1} \sum_{k=1}^{16} \Im\left\{
     \trace\left(
       -\ii\,
       \Op\sigma_{k,n}^{(i)}(t)
       \left[
        \frac{\partial \Op{H}_n}{\partial \Omega_j},
        \Op{\rho}_{k,n}^{(i+1)}(t)
       \right]
     \right)\right\}\,,
\end{equation}
with the $\Op\sigma_{k,n}^{(i)}(t)$ being a set of co-states backwards
propagated with the pulse from the previous iteration, cf.~\eqref{eq:bw_eqm},
\begin{equation}
  \label{eq:backward_prop}
  \frac{\partial \Op{\sigma}_{k,n}(t)}{\partial t}
  = -\frac{\ii}{\hbar} [\Op H_n(t),\Op{\sigma}_{k,n}(t)]
    - \mathcal{L}_D(\Op{\sigma}_{i,n}(t))\,.
\end{equation}
Note the change of sign for the dissipator compared to
Eq.~\eqref{eq:LvN_rydberg}. This reflects the propagation under the adjoint
equation of motion, expressed as $\Op{H}^{\dagger}$ in Eq.~\eqref{eq:bw_eqm}.
The `initial' condition for the propagation of $\Op{\sigma}$ is determined by
the final time objective,~cf.~Eq.\eqref{eq:chi_boundary}, resulting in
\begin{equation}
  \Op{\sigma}_{k,n}(t=T) = \Op{O} \Op{\rho}_{k}(0) \Op{O}^\dagger\,.
\end{equation}
This corresponds to~Eq.~\eqref{eq:chi_JTre}, with the normalization prefactor
absorbed in $\lambda_j$.
The states $\Op{\rho}_{k,n}^{(i+1)}(t)$ in Eq.~\eqref{eq:update}
are forward propagated using the pulse of the
current iteration, according to Eq.~\eqref{eq:LvN_rydberg}.
In the case of the rotating wave approximation where the $\Omega_j(t)$ are
complex, Eq.~\eqref{eq:update} is valid for both the real and the imaginary part
of the pulse.
%%%%
%%%%%

\subsection{Optimized Rydberg Gates}


In order to optimize for robustness with respect to both amplitude fluctuations
and fluctuations of the Rydberg level, we choose an ensemble of $N=24$
Hamiltonians, evenly sampling the values of $\Delta_{\ryd}$ between
\SI{+-300}{kHz} and variations of the dipole coupling strength between $\pm 5\%$.
The resulting pulses and their spectra are shown in Fig.~\ref{fig:octpulses},
in the two-color rotating frame. In the spectra, the central frequency of
zero corresponds to a laser frequency of the blue pulse that is detuned by
$\Delta_1$ with respect to the $\Ket{0} \rightarrow \Ket{i}$ transition. For
the red pulse, it indicates the frequency for which there is a two-photon
resonance with the $\Ket{0} \rightarrow \Ket{r}$ transition.
The guess pulses from which the optimization started are indicated in orange;
they are inspired by the analytic scheme of the previous section,
consisting of two $\pi$ pulses on the left atom and simultaneously one $2\pi$
pulse on the right atom. The gate duration was set to $T=\SI{800}{ns}$, matching
the shortest gate duration obtained for the analytic schemes in the previous
section.
The choice of the guess pulse is arbitrary in principle,
but has significant impact on the convergence speed and the characteristics of
the optimized pulse. Indeed, the optimized pulse shapes still roughly follow
the shapes of the guess pulses. However, especially for the left atom, there are
fast oscillations present in
the optimized pulse shapes. These correspond to a second laser
frequency. As can be seen from the spectra shown in
Fig.~\ref{fig:octpulses}~(c), this second
frequency is at $+\Delta_1$ for the blue pulse and at $-\Delta_1$ for the red
pulse. This
allows a pathway interference to be set up in the energy level space, as follows.
Pulses at these additional frequencies are now two-photon resonant with
the $\Ket{0} \rightarrow \Ket{r}$ transition and thereby introduce a second
excitation pathway whose interference with the primary pathway can be exploited
as a control mechanism. The optimization procedure takes advantage of this
mechanism to enhance the overall gate fidelity by utilizing the interference
between excitation amplitude contributions from these distinct paths connecting
the atomic ground and Rydberg state.  We note that the blue side peak is smaller
as a result of the smaller amplitude of the corresponding laser.  Indeed, in the
spectra of the pulses acting on the right atom,
cf.\ Fig.~\ref{fig:octpulses}~(d),
the second frequency is mostly absent, except for the very beginning and end of
the red pulse.

\begin{figure}[tb]
  \centering
  \includegraphics{robust_oct_pulses}
  \caption{%
  Amplitudes and spectra of pulses optimized with respect to variations
  in both two-photon detuning and pulse amplitude, for a gate duration of
  $T=\SI{800}{ns}$.
  The central peaks in the
  spectra are truncated to emphasize the side-peaks, reaching
  2.0 (red) and 0.8 (blue) in panel (c), and 1.4 (red) and 1.0 (blue) in panel
  (d).
  The frequencies matching $\pm \Delta_1$ are indicated by vertical dashed gray
  lines.
  }
  \label{fig:octpulses}
\end{figure}
\begin{figure}[tb]
  \centering
  \includegraphics{robust_oct_pop}
  \caption{%
  Dynamics under the pulses optimized with respect to fluctuations
  in both the Rydberg level and pulse amplitudes, as shown in
  Fig.~\ref{fig:octpulses}.
  The intermediate population in the bottom panel (``int'') is integrated over
  the states $\Ket{0i}$, $\Ket{i0}$, $\Ket{ii}$, $\Ket{ir}$, and $\Ket{ri}$.
  The shown dynamics implement the desired CPHASE gate up to
  a gate error of \num{1.04e-4}.}
  \label{fig:octdyn}
\end{figure}
The population induced by the optimized pulses with the ideal Hamiltonian
$\Op{H}_0$ is shown in Fig.~\ref{fig:octdyn}. Even though the optimized pulses
have frequency components that are resonant with the $\Ket{0} \rightarrow
\Ket{i}$ transition, the intermediate level is now never significantly populated, due to
destructive interference along the two pathways in energy
space. Suppression of the intermediate state population may
be aided by the STIRAP-like feature of the optimized pulse shape, in
Fig.~\ref{fig:octpulses}~(a) and~(b), where the red laser
(counter-intuitively) precedes the blue laser in the initial depopulation of the
$\Ket{0}$ level of the left atom, and follows it in the final repopulation.
Furthermore, the population of the $\Ket{01}$ state stays remarkably constant, despite
the rather large amplitudes of the laser fields in
Fig.~\ref{fig:octpulses}~(a). Again, this is due
to the interfering multiple pathways. In contrast, the dynamics of the
$\Ket{10}$ state is much more straightforward, on account of the absence of
the second laser frequency. The pulse consists effectively of a single $2 \pi$ pulse,
although not with full population transfer.
The Rydberg blockade is almost fully maintained, cf.\ the lack of
population in the $\Ket{rr}$ state in the bottom panel of Fig.~\ref{fig:octdyn}.
Also, the right atom in the time evolution of the $\Ket{00}$ state is almost
unaffected by the pulse on the right atom, resulting in very similar
population dynamics for the $\Ket{00}$ and $\Ket{01}$ states.


\begin{figure}[tb]
  \centering
  \includegraphics{robust_oct_pulses100}
  \caption{%
  Amplitudes and spectra of pulses optimized with respect to variations
  in both two-photon detuning and pulse amplitude, for a gate duration of
  $T=\SI{100}{ns}$. The spectra are drawn on the same scale as in
  Fig.~\ref{fig:octpulses}, with the central peaks in panel (c) reaching 4.5
  (blue) and 3.0 (red), and 4.5 for both pulses in panel (d).
  %Spectra scaled by 4.5
  }
  \label{fig:octpulses100}
\end{figure}
Optimal control also holds the promise of finding pulses approaching the quantum
speed limit. With numerical optimization, we can find solutions with
gate durations far below $T=\SI{800}{ns}$
required for the analytic schemes, although very short pulses may require
unfeasibly large pulse amplitudes.
The pulses and spectra resulting from an
optimization for $T=\SI{100}{ns}$ are shown in Fig.~\ref{fig:octpulses100}. The
pulses are optimized for robustness, using the same ensemble of Hamiltonians
as for the $T=\SI{800}{ns}$ pulses. The pulse shapes again follow the features of the
guess pulse, and are only slightly more complex than those for \SI{800}{ns} in
Fig.~\ref{fig:octpulses}, and should be well within reach of established
nanosecond pulse shaping techniques~\cite{WrightRSI04}.

The spectra in Fig.~\ref{fig:octpulses100} (c) and (d)  reveal that
a similar pathway interference
mechanism as seen in the optimized  $T=\SI{800}{ns}$ pulse sequences
operates, realized by the additional frequencies at $\pm
\Delta_1$. The most significant
difference from Fig.~\ref{fig:octpulses} is that now the additional frequencies
are present for both the left and the right atom throughout the entire gate
duration. As a result of the shorter time window,
the peaks in the spectrum are broadened and the
pulse amplitudes are now significantly higher. Generally, the optimization
becomes harder for shorter pulse durations and the available control
mechanism must now be used more efficiently: This rationalizes the
presence of the second laser frequency throughout all pulses.

\begin{figure}[tb]
  \centering
  \includegraphics{robust_oct_pop100}
  \caption{%
  Dynamics under the optimized pulses shown in
  Fig.~\ref{fig:octpulses100}. The gate error is \num{1.92e-4}.}
  \label{fig:octdyn100}
\end{figure}
The population dynamics in Fig.~\ref{fig:octdyn100} show some
significant differences from the
dynamics shown in Fig.~\ref{fig:octdyn}, as a result of the increase
in laser amplitude.
Most importantly, the Rydberg blockade
is now broken, resulting in a significant population of the $\Ket{rr}$ state,
cf.\ the purple curve in the bottom panel. This nicely illustrates the power of
OCT; while the analytic schemes rely on maintaining the blockade regime, the
optimization has no such restrictions, and will exploit any pathways available
in the time evolution generated by the two-qubit Hamiltonian.
There is some minor population in the intermediate
states during the propagation of the $\Ket{00}$ state, cf.\ the blue line in the
bottom panel of Fig.~\ref{fig:octdyn100}. However, since the dynamics result
from an optimization that  explicitly took into account the spontaneous decay from the
intermediate level, we are guaranteed that the population in this
level is below a threshold value that would affect the gate fidelity.

\begin{figure}[tb]
  \centering
  \includegraphics{robustness_oct}
  \caption{%
    Expectation value of the gate error in the presence of fluctuations
    in the $\Ket{rr}$ state due to DC electric fields (top), and pulse amplitude
    fluctuations (bottom). The red dashed curve shows the most robust analytical
    pulse, cf.\ the red dashed curve in Fig.~\ref{fig:pulserobust}. The solid
    yellow and blue lines are for the optimized pulses shown in
    Figs.~\ref{fig:octpulses},~\ref{fig:octpulses100}, respectively. The dotted
    green line is for a further optimized pulse at $T=\SI{800}{ns}$, without
    any consideration of limits on the pulse amplitude or complexity.
    Note that both panels show the robustness for same set of pulses, i.e.\ the
    pulses were optimized with respect to \emph{both} variations in the
    two-photon detuning and the pulse amplitude.
    }
  \label{fig:robustoct}
\end{figure}
In Fig.~\ref{fig:robustoct}, we compare the effect of fluctuations
due to electric fields and pulse amplitude fluctuations on
the gate fidelity for the pulses obtained with OCT, cf.\
Figs.~\ref{fig:octpulses} and~\ref{fig:octpulses100}, to that for the most
robust gates achieved with the analytic schemes, i.e., the
mixed scheme employing STIRAP for the pulses on the left atom, and simultaneous
pulses for the right atom, cf.\ Fig.~\ref{fig:pulserobust}.
The optimized pulses are significantly more robust with respect to both sources
of error by at least an order of magnitude, with the gate fidelity staying above
99.9\% even for large variations, whereas for the analytic pulses, it drops
below 97\% for fluctuations of the Rydberg level (top panel) and 95\% for
amplitude fluctuations (bottom panel).
Note that in contrast to the analytic mixed scheme, the optimized pulses do not
require unfeasibly large pulse amplitudes.
In contrast, the scheme using only simultaneous
pulses but more realistic pulse amplitudes would be even more sensitive --
particularly to fluctuations of the Rydberg level (cf.\ the drop to 92\% gate
fidelity in the top panel of Fig.~\ref{fig:pulserobust}). The price for
this additional robustness offered by the numerically optimized pulses
is a slightly more complex pulse shape and the
presence of a second frequency.

It is important to note that the solutions provided by OCT are not unique; the
pulses obtained depend on the guess pulses, the exact choice of optimization
functional, and on arbitrary scaling parameters such as the $\lambda_j$ in
Eq.~\eqref{eq:functional}. By tuning these parameters carefully, the
optimization may be steered towards desired pulse features.
It is also possible to add additional constraints to the
optimization functional in order to preselect optimization
pathways~\cite{JosePRA13}. For example, the $\Ket{rr}$ state could
be defined as a forbidden subspace in order to enforce the blockade regime. This
could be desirable, since the breaking of the Rydberg blockage can excite the
atoms vibrationally, resulting in a possible increase of gate duration due to the
additional time required to restore the original state of motion. The
vibrational motion was not taken into account in the our model. It could be
included explicitly in the optimization to determine the speed limit outside of
the blockage regime \cite{GoerzJPB11}.
One could also include spectral
constraints to impose a pre-specified pulse bandwidth or suppress
undesired frequency components~\cite{JosePRA13,ReichJMO2014}.
Optimizing to extremely high fidelities often leads to very large
pulse amplitudes or complex pulse features that are undesirable from an
experimental point of view. Thus, it is usually best to stop the optimization as
soon as the reached fidelities are ``good enough'', as was done for the
optimized pulses shown as solid blue  and yellow  lines in
Fig.~\ref{fig:robustoct}.
In principle, however, pulses of much higher fidelity
and robustness than those shown here can be found.  This is illustrated by the
dotted green line in Fig.~\ref{fig:robustoct}, which shows the result of
a further optimization of the pulse for $T=\SI{800}{ns}$.
While these pulses achieve a
gate fidelity well above that required for fault tolerant
quantum computation~\cite{gottesman2013overhead,reichardt2009error,aliferis2008err},
the resulting highly optimized pulses
have unfeasibly large pulse amplitudes of \SI{1100}{MHz} and \SI{330}{MHz} for the blue
and red laser, respectively.
% left blue : 270 MHz
% left red  : 250 MHz
% right blue: 1100 MHz
% right red : 330 MHz

The results presented here illustrate the power of optimal control theory as
a tool for finding pulses that are robust both with respect to decoherence and to
experimental fluctuations. For realistic noise levels,
we were able to generate pulses that yield gate errors well below $10^{-3}$,
with errors  below $10^{-5}$ being reached when no limits are placed on pulse
amplitudes.
Optimized pulse sequences are not only more robust but can also be
of much shorter duration, significantly shorter than those obtained from the
best analytical schemes. This is a considerable advantage, allowing to perform
a larger number of gates before decoherence effects become significant.
The technique of optimizing over an ensemble of perturbed
Hamiltonians in order to achieve robust pulses is not limited to the example of
Rydberg gates, but is generally applicable to other systems and optimizations
problems.

