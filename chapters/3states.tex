% vim: ft=tex iskeyword=@,48-57,_,-,192-255,\: dictionary=bibkeys.lst,labels.lst:
\chapter{Efficient Optimization of Unitaries in Liouville Space}
\label{chap:3states}


The preceding chapters~\ref{chap:robust} and~\ref{chap:pe} have illustrated
the power of optimal control theory (OCT) for the robust implementation of quantum
gates. Both dissipation and classical noise can be taken into account explicitly
in the functional, allowing OCT to determine the pathways that result in the
best possible fidelities under the present physical constraints. Using more
general functionals to give the optimization more freedom can greatly enhance
the chances of success. Many implementations of quantum computing show
continuing advances in maintaining coherence. For superconducting qubits,
coherence times have increased from \SI{2}{ns} for the first Cooper pair
boxes~\cite{NakamuraN1999} to \SI{\sim 0.1}{ms} for 3D
transmons~\cite{RigettiPRB2012}, an improvement over five orders of magnitude.
In light of this, it may be possible to forgo a treatment in Liouville space,
using OCT together with the perfect-entanglers functional to push two-qubit gate
durations to the quantum speed limit, on a time scale where decoherence is not
relevant. However, as long as at least some channels of dissipation act
on the relevant time scales for the realization of a gate, a realistic
description will generally require to modeling the dynamics in Liouville space.
Moreover, in a non-Markovian setting, it may be possible to exploit strong
interactions with parts of the environment to aid the implementation of
a quantum gate~\cite{ReichArXiv1409.7497}.

Modeling quantum dynamics in Liouville space raises the question of numerical
efficiency. Compared to Hilbert space, where states are described as a complex
vector of dimension $N$, the corresponding density matrix has dimension $N^2$.
Moreover, optimization for a quantum gate using the standard functionals
presented in chapter~\ref{chap:numerics} requires to propagate a full basis of
the logical subspace of dimension $d$. Again, this scales quadratically in
Liouville. For gradient-based optimization schemes such as GRAPE or Krotov's
method, it is necessary to store the entire time evolution of each required
state, see Fig.~\ref{fig:krotovscheme}. This can quickly push the boundaries of
available numerical resources. For example, optimizing a two-qubit gate, $d=4$,
on a Hilbert space of modest dimension $N=500$ (e.g., two transmon qubits with
5 levels coupled to a cavity of 20 levels) requires \SI{4}{megabyte} storage for
a single state. For a time discretization of only 1000 steps, at least 16000
states ($1000 \times 16$~matrices spanning the logical Liouville subspace) must
be kept in memory, requiring 64~gigabytes of memory.

This chapter, adapted from Ref.~\cite{Goerz3States}, illustrates that it is
\emph{not} necessary to propagate a full basis of Liouville space when
optimizing for a unitary operation. This insight builds on results from quantum
tomography~\cite{ReichKochPRA13, ReichKochPRL13} concerning the minimum
resources required to characterize the implementation of quantum gates. 
In essence, the direct extension of functionals such as Eq.~\eqref{eq:JTsm} and
Eq.~\eqref{eq:JTre} from Hilbert to
Liouville space~\cite{KallushPRA06,OhtsukiNJP10,ToSHJPB11}
overlooks the fact that in quantum gate optimization,
the target is a unitary operation and not a general dynamical map.
Thus, the gate fidelity can be determined without a full reconstruction of the
dynamical map, which would indeed require a basis that spans the full Liouville
space.

In general, propagation of only three states is sufficient to optimize a quantum
gate. Mathematically, this is based only only two states being necessary to
distinguish any two unitaries, irrespective of Hilbert space
dimension~\cite{ReichKochPRA13}.
A third state is required to enforce that the dynamical map on the optimization
subspace is contracting and population conserving,

\enlargethispage{\baselineskip}
If the system Hamiltonian only allows for the implementation of diagonal
gates, the number of required states reduces to two; this is demonstrated for
the example of a Rydberg gate, using the same model as in
chapter~\ref{chap:robust}. The general case of non-diagonal quantum gates is
illustrated by a \sqrtISWAP{} gate on transmon qubits, using the same model as
in chapter~\ref{chap:pe}.  While the use of three, respectively two states is
sufficient in principle, the rate of convergence can be improved by extending
the number of states. This corresponds to the observation that while
two states represent the minimal set of states required to
distinguish any two unitaries, they do not allow to deduce bounds on the gate
error~\cite{ReichKochPRA13}. A set of $d$ or $2d$ allows to determine
a numerical and analytical bound, respectively.
Therefore, depending on the desired gate error, propagation of either $d+1$
(including the extra state required to enforce unitarity) or
$2d$ states is the numerically most efficient choice. Already for a two-qubit
gate, this represents a significant reduction in the number of
states that need to be propagated, from 16 for the full Liouville space basis to
8 and 5, respectively.


%Meaningful bounds on the gate error can be derived numerically when replacing
%the totally mixed state by a set of $d$ pure states where $d$ is the dimension of
%Hilbert space, i.e., by choosing a separate basis state for each
%Hilbert space direction~\cite{ReichKochPRA13,FiurasekPRA14}. The resulting set
%consists of $d+1$ states. Analytical bounds are obtained when also the
%second state of the minimal set is expanded~\cite{HofmannPRL05}. The
%corresponding set is built out of the $2d$ states of two mutually
%unbiased bases~\cite{ReichKochPRA13}. This observation from process
%verification motivates the choice of optimization functionals which
%utilize these extended sets of states. Although the
%number of states then depends on Hilbert space dimension, this choice still
%comes with very significant savings in the computational resources.
%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section[A Minimal Set of States for the Opt.~Control of Unitaries]{A Minimal Set of States for the Optimal Control of Unitaries}

\label{sec:3st_oct}

\vspace{24pt}
\subsection{Unitary Operations in Liouville Space}

When optimizing a quantum gate $\Op{O}$, we require that despite the presence
of dissipation, the evolution of a state $\Op{\rho}$ is unitary,
\begin{equation}
  \Op{\rho(T)} = V[\Op{\rho}(t=0)] \equiv \Op{U} \Op{\rho}(t=0) \Op{U}^\dagger\,,
  \label{eq:unitary_dynmap}
\end{equation}
or at least as unitary as possible. In a second step, we then require that the
obtained gate $\Op{U}$ is identical to the desired gate $\Op{O}$.
Intuitively, Eq.~\eqref{eq:unitary_dynmap} is fulfilled if all propagated states
maintain purity one. If we assume that the dynamics are indeed unitary, we
may ask how to determine the implemented gate $U$ by propagating a well-chosen
set of states. If we know $U$ to be diagonal,
\begin{equation}
  \Op{U} = \diag\left( \ee^{\\ii \phi_00}, \ee^{\\ii \phi_01}, \ee^{\\ii
                       \phi_10}, \ee^{\\ii \phi_11} \right)
\end{equation}
this becomes quite easy, as we only need to determine the four phases to specify
the gate. Propagation of the state $\Op{\rho}_{\superpos}$ corresponding to the
coherent superposition of all $d$ logical basis states,
\begin{equation}
    \left(\Op\rho_{\superpos}(0)\right)_{ij} = \frac{1}{d}\,,
    \label{eq:rho_superpos}
\end{equation}
yields
\begin{equation}
  \Op{U} \Op{\rho}_{\superpos} \Op{U}^\dagger
  = \begin{pmatrix}
    1                                           & \ee^{\ii \left(\phi_{1} - \phi_{2}\right)}   & \ee^{\ii \left(\phi_{1} - \phi_{3}\right)} & \ee^{\ii \left(\phi_{1} - \phi_{4}\right)}\\
    \ee^{\ii \left( \phi_{2} - \phi_{1}\right)} & 1                                            & \ee^{\ii \left(\phi_{2} - \phi_{3}\right)} & \ee^{\ii \left(\phi_{2} - \phi_{4}\right)}\\
    \ee^{\ii \left( \phi_{3} - \phi_{1}\right)} & \ee^{\ii \left(\phi_{3} - \phi_{2}\right)}   & 1                                          & \ee^{\ii \left(\phi_{3} - \phi_{4}\right)}\\
    \ee^{\ii \left( \phi_{4} - \phi_{1}\right)} & \ee^{\ii \left(\phi_{4} - \phi_{2}\right)}   & \ee^{\ii \left(\phi_{4} - \phi_{3}\right)} & 1
  \end{pmatrix}\,.
  \label{eq:U_rho_superpos}
\end{equation}
We may choose $\phi_{1} = 0$, which corresponds to a specific global phase; all
other phases can the directly be read off from the entries
of~\ref{eq:U_rho_superpos}. When $\Op{U}$ is not diagonal, the result of
propagating a mixed state with non-degenerate eigenvalues, e.g.
\begin{equation}
  (\Op{\rho}_{\mixed})_{ij} = \frac{2\left(d-i+1\right)}{d\left(d+1\right)}\delta_{ij}
  \label{eq:rho_mixed}
\end{equation}
can be diagonalized to obtain the basis in which $U$ is diagonal.
% XXX Expand
The superposition state that determines the phase information of $\Op{U}$ is
then constructed in this new basis.

\newpage
The numerical diagonalization that is required in order to construct the
gate means that there is no way to calculate analytical
derivatives of $\Op{U}$. While a direct gate optimization with functionals
based on Eq.~\eqref{eq:tau_liouville} and using Krotov's method is possible,
more advanced functionals that depend explicitly only on $\Op{U}$ cannot, such
as those discussed in chapter~\ref{chap:pe} are not available. Such functionals
require an analytical construction of
\begin{equation}
\Op{U} =
\begin{pmatrix}
  r_{11} \ee^{\ii \phi_{11}} & r_{12} \ee^{\ii \phi_{12}} & r_{13} \ee^{\ii \phi_{13}} & r_{14} \ee^{\ii \phi_{14}}\\
  r_{21} \ee^{\ii \phi_{21}} & r_{22} \ee^{\ii \phi_{22}} & r_{23} \ee^{\ii \phi_{23}} & r_{24} \ee^{\ii \phi_{24}}\\
  r_{31} \ee^{\ii \phi_{31}} & r_{32} \ee^{\ii \phi_{32}} & r_{33} \ee^{\ii \phi_{33}} & r_{34} \ee^{\ii \phi_{34}}\\
  r_{41} \ee^{\ii \phi_{41}} & r_{42} \ee^{\ii \phi_{42}} & r_{43} \ee^{\ii \phi_{43}} & r_{44} \ee^{\ii \phi_{44}}
\end{pmatrix}\,,
\label{eq:U_full_parametr}
\end{equation}
in the case of a two-qubit gate.
Such a construction is provided by propagating the $d$ states that contain
a non-zero element only in the first column, e.g.\ the dyadic products
\begin{subequations}
\begin{align}
  \Op{\rho}_1 = \KetBra{00}{00}\,, \quad &
  \Op{\rho}_2 = \KetBra{01}{00}\,, \\
  \Op{\rho}_3 = \KetBra{10}{00}\,, \quad &
  \Op{\rho}_4 = \KetBra{11}{00}\,,
\end{align}
\end{subequations}
The matrix entries $(a,b)$ of the propagated state $\Op{\rho}_k$ are
\begin{equation}
  \left( \Op{U} \Op{\rho}_k \Op{U}^\dagger \right)_{ab}
  = r_{b1} r_{ai} \ee^{\ii \left( \phi_{ai} - \phi_{b1} \right)}\,.
\end{equation}
The propagation of $\Op{\rho}_1$ alone determines all the entries in the first
column of Eq.~\eqref{eq:U_full_parametr} (again with choosing one of the phases as
zero). Plugging in the obtained values into the propagation of $\Op{\rho}_2$
then completely determines the second column of Eq.~\eqref{eq:U_full_parametr},
and so forth. This gives an explicit construction of $\Op{U}$, which now in
principle allows to calculate the necessary derivatives for functionals like the
one for the optimization of a general perfect entangler, analogously to
appendix~\ref{AppendixPE}.

%{\footnotesize
%\begin{equation}
%  \begin{pmatrix}
%  r_{11}^{2} & r_{11} r_{21} e^{i \left(\phi_{11} - \phi_{21}\right)} & r_{11} r_{31} e^{i \left(\phi_{11} - \phi_{31}\right)} & r_{11} r_{41} e^{i \left(\phi_{11} - \phi_{41}\right)}\\
%  r_{11} r_{21} e^{i \left( \phi_{21} - \phi_{11} \right)} & r_{21}^{2} & r_{21} r_{31} e^{i \left(\phi_{21} - \phi_{31}\right)} & r_{21} r_{41} e^{i \left(\phi_{21} - \phi_{41}\right)}\\
%  r_{11} r_{31} e^{i \left( \phi_{31} - \phi_{11} \right)} & r_{21} r_{31} e^{i \left( \phi_{31} - \phi_{21} \right)} & r_{31}^{2} & r_{31} r_{41} e^{i \left(\phi_{31} - \phi_{41}\right)}\\
%  r_{11} r_{41} e^{i \left( \phi_{41} - \phi_{11} \right)} & r_{21} r_{41} e^{i \left( \phi_{41} - \phi_{21} \right)} & r_{31} r_{41} e^{i \left( \phi_{41} - \phi_{31} \right)} & r_{41}^{2}
%  \end{pmatrix}
%\end{equation}
%}
%
%{\footnotesize
%\begin{equation}
%  \begin{pmatrix}
%  r_{11} r_{12} e^{i \left( \phi_{12} - \phi_{11} \right)} & r_{12} r_{21} e^{i \left(\phi_{12} - \phi_{21}\right)} & r_{12} r_{31} e^{i \left(\phi_{12} - \phi_{31}\right)} & r_{12} r_{41} e^{i \left(\phi_{12} - \phi_{41}\right)}\\
%  r_{11} r_{22} e^{i \left( \phi_{22} - \phi_{11} \right)} & r_{21} r_{22} e^{i \left( \phi_{22} - \phi_{21} \right)} & r_{22} r_{31} e^{i \left(\phi_{22} - \phi_{31}\right)} & r_{22} r_{41} e^{i \left(\phi_{22} - \phi_{41}\right)}\\
%  r_{11} r_{32} e^{i \left( \phi_{32} - \phi_{11} \right)} & r_{21} r_{32} e^{i \left( \phi_{32} - \phi_{21} \right)} & r_{31} r_{32} e^{i \left( \phi_{32} - \phi_{31} \right)} & r_{32} r_{41} e^{i \left(\phi_{32} - \phi_{41}\right)}\\
%  r_{11} r_{42} e^{i \left( \phi_{42} - \phi_{11} \right)} & r_{21} r_{42} e^{i \left( \phi_{42} - \phi_{21} \right)} & r_{31} r_{42} e^{i \left( \phi_{42} - \phi_{31} \right)} & r_{41} r_{42} e^{i \left( \phi_{42} - \phi_{41} \right)}
%  \end{pmatrix}
%\end{equation}
%}

So far, we have only considered how to obtain the gate $\Op{U}$ under the
assumption that the dynamical map is unitary. However, when not propagating the
full basis of Liouville space, it is not guaranteed that the non-unitarity is
reflected in the single pure density matrix in the set of propagated matrices in
either of the above two scenarios. The non-unitarity might be either due to
dissipation, or due to loss from the logical subspace by leakage into higher
levels. It can be shown~\cite{Goerz3States,
ReichKochPRA13} that for a direct gate optimization, in addition to the states
in Eq.~\eqref{eq:rho_superpos} and Eq.~\eqref{eq:rho_mixed}, a third state can
be added to guarantee that the optimization is able to detect non-unitarity in
the dynamical map. 
The optimization is successful if, and only if
\begin{equation}
  \Op\rho_{k}(T) =
  \Op{O}\Op{\rho}_{k}(0)\Op O^{\dagger}
  \label{eq:3st_cond}
\end{equation}
for the three states $\Op\rho_k$.
The total set of states that is sufficient for a direct get optimization reads
\begin{subequations}\label{eq:3st_rhos}
  \begin{align}
    \left(\Op\rho_{1}(0)\right)_{ij} & =
    \frac{2\left(d-i+1\right)}{d\left(d+1\right)}\delta_{ij}\,,\label{eq:3st_rho1}\\
    \left(\Op\rho_{2}(0)\right)_{ij} &= \frac{1}{d}\,,\label{eq:3st_rho2}\\
    \left(\Op\rho_{3}(0)\right)_{ij} &= \frac{1}{d}\delta_{ij}\,,\label{eq:3st_rho3}
  \end{align}
\end{subequations}
where the matrix elements are given in the optimization subspace,
all other elements are zero.


\subsection{Optimization Functional}
\label{subsec:3st_func}

In order to employ optimal control theory, we must define a distance measure
$J_T$ between the desired unitary $\Op O$ and the actual evolution, as a final
time functional. We generalize Eq.~\eqref{eq:JTre} to
\begin{equation}
  J_T = 1 - \sum_{k=1}^{n}
    \frac{w_k}{\Tr[\Op\rho_k^2(0)]} \, \mathfrak{Re}\left\{\Tr\left[
    \Op O\Op\rho_{k}(0)\Op O^{\dagger}\Op\rho_{k}\left(T\right)\right]\right\}
  \label{eq:3st_functional}
\end{equation}
with $n=3$ and using the states $\Op\rho_k(0)$ defined in Eq.~\eqref{eq:3st_rhos}
This is in contrast to
Refs.~\cite{KallushPRA06,OhtsukiNJP10,ToSHJPB11}, where $n$ was taken
to be the Liouville space dimension corresponding to $\Op O$,
i.e., $n=2^{2N}$ for $N$ qubits,
and $\Op\rho_k$ an orthonormal basis (under the Hilbert-Schmidt
product) of Liouville space.
The three states are constructed such that the first one fixes a basis, and the corresponding
Hilbert-Schmidt product in Eq.~\eqref{eq:3st_functional} checks whether
the gate is correctly implemented in this basis. It misses errors
for gates that are diagonal in the basis, i.e., phase
errors~\cite{ReichKochPRA13}. The second state is therefore chosen to
detect phase errors with its Hilbert-Schmidt product in
Eq.~\eqref{eq:3st_functional}~\cite{ReichKochPRA13}. The Hilbert-Schmidt
product of the third state determines
whether the dynamical map attained at time $T$ conserves the
population within the optimization subspace.
In Eq.~\eqref{eq:3st_functional}, $w_k$ are  weights,
normalized as $\sum_{k=1}^n w_k = 1$, that allow to put more or less importance
to the properties checked by each of the three states.
In order to evaluate $J_T$, the time evolved states $\Op\rho_k(T)$
need to be obtained by solving the equation of motion describing the open
system's evolution for $\Op\rho_k$. While in general the dynamics can
be non-Markovian, we will restrict ourselves to a Markovian master
equation in the examples below. We assume the coherent part to include
coupling to
an external control, i.e., the Hamiltonian is of the form $\Op{H}(t)=\Op{H}_0
+ \epsilon(t)\Op H_1$, and generalization to several
controls $\epsilon_i(t)$ is straightforward.

The states $\Op\rho_1$ and $\Op\rho_2$ of Eq.~\eqref{eq:3st_rhos}, while
sufficient in principle to distinguish any two unitaries, do not allow
for stating bounds on the gate
error~\cite{ReichKochPRA13}. Meaningful bounds on the gate error can
be obtained numerically by replacing $\Op\rho_1$,
$\Op\rho_2$ by a set of $d+1$ states, whereas analytical
bounds can be deduced from  $2d$
states~\cite{ReichKochPRA13,HofmannPRL05,FiurasekPRA14}. Motivated by this fact,
we define two additional sets of states that can be employed in
Eq.~\eqref{eq:3st_functional}. When $n$ in Eq.~\eqref{eq:3st_functional} is
taken to be  equal to $d+1$, the totally mixed state of
Eq.~\eqref{eq:3st_rho1} is replaced by $d$ pure states,
\begin{equation}
  \label{eq:3st_rho1_dp1}
  \Op\rho_j(0) = |\varphi_j\rangle\langle\varphi_j|\,,
\end{equation}
with $j=1,\ldots,d$ and $\{|\varphi_j\rangle\}$ the logical basis.
$\Op\rho_{d+1}(0)$ is simply equal to $\Op\rho_2(0)$ of
Eq.~\eqref{eq:3st_rho2}. In this case, Eq.~\eqref{eq:3st_rho3} is not required since
the $d+1$ pure states are sufficient to enforce the dynamical map on
the optimization subspace to be contracting and norm conserving.
Similarly, the functional~\eqref{eq:3st_functional} employing
$n=2d$ states is constructed by replacing $\Op\rho_1(0)$ of
Eq.~\eqref{eq:3st_rho1} by $\Op\rho_j$, $j=1,\ldots,d$ of
Eq.~\eqref{eq:3st_rho1_dp1} and $\Op\rho_2(0)$ of
Eq.~\eqref{eq:3st_rho2} by
\begin{equation}
  \label{eq:3st_rho2_2d}
  \Op\rho_{d+j}(0) = |\tilde\varphi_{j}\rangle\langle\tilde\varphi_{j}|\,,
\end{equation}
with $j = 1,\dots,d$,
where the states $\Ket{\tilde\varphi_j}$ form a mutually unbiased basis with
respect to the canonical basis $\{\Ket{\varphi_j}\}$. For two
qubits  ($d=4$), an example for such a basis is given by
\begin{subequations}\label{eq:3st_mub}
  \begin{align}
    \Ket{\tilde\varphi_{1}}
    &= \frac{1}{2} \left( \Ket{00} + \Ket{01} + \Ket{10} + \Ket{11} \right) \,,\\
    \Ket{\tilde\varphi_{2}}
    &= \frac{1}{2} \left( \Ket{00} - \Ket{01} + \Ket{10} - \Ket{11} \right) \,,\\
    \Ket{\tilde\varphi_{3}}
    &= \frac{1}{2} \left( \Ket{00} + \Ket{01} - \Ket{10} - \Ket{11} \right) \,,\\
    \Ket{\tilde\varphi_{4}}
    &= \frac{1}{2} \left( \Ket{00} - \Ket{01} - \Ket{10} + \Ket{11} \right) \,.
  \end{align}
\end{subequations}


\subsection{Optimization with Krotov's Method}
\label{subsec:3st_krotov}

In order to obtain an update equation for Krotov's method, a state dependent
constraint as in Eq.~\eqref{eq:g_a_delta} is added to the final time functional,
Eq.~\eqref{eq:3st_functional}.  As discussed in chapter~\ref{chap:numerics}, more
complex additional constraints are conceivable, for example restricting the
spectral width of the pulse or confining the accessible state space~\cite{ReichKochJMO13,JosePRA13}.
The full optimization functional is linear in the states $\Op\rho_k(T)$ and does
not depend on the states at intermediate times $t$, so that the
linear version of Krotov's method is sufficient to yield a
monotonically convergent optimization algorithm. 
Modeling the dissipative time evolution by a Markovian master equation,
\begin{equation}
  \label{eq:3st_LvN}
  \frac{d\Op\rho}{dt} = \mathcal{L}(\Op\rho) = -i[\Op H(t),\Op\rho]
  +\mathcal{L}_D(\Op\rho)\,.
\end{equation}
The control equations then read
\begin{subequations}\label{eq:3st_control}
  \begin{align}
    \label{eq:3st_forward}
    \frac{\partial\Op\rho_k}{dt} &= -i[\Op H,\Op\rho_k] +\mathcal{L}_D(\Op\rho_k)\,,\\
    \label{eq:3st_backward}
    \frac{\partial\Op\sigma_k}{dt}
    &= -i[\Op H,\Op\sigma_k] -\mathcal{L}_D(\Op\sigma_k)
    % \,,\\  \label{eq:3st_T}
    \quad\mathrm{and}\quad
    \Op\sigma_k(t=T) =
    \frac{w_k}{\Tr[\Op\rho_k^2(0)]}
     \Op O \Op \rho_k(0) \Op O^{\dagger}\,,\\
     \label{eq:3st_update}
     \Delta\epsilon(t) &=
     \frac{S(t)}{\lambda_a} \sum_{k=1}^n \Im\left\{
     \Tr\left(
       \Op\sigma_k^{\old}(t)
       \frac{\partial \mathcal{L}\left(\Op\rho_k\right)}{\partial \epsilon}
       \Big|_{\rho_k^\mathrm{new},\epsilon^\mathrm{new}}
     \right)\right\}
   \end{align}
\end{subequations}
with $k=1,2,3$ when the initial conditions $\Op\rho_k(0)$
of Eq.~\eqref{eq:3st_rhos} are
employed or $k=1,\ldots d^2$ with $d$ the dimension of Hilbert space
when a full basis of Liouville space is propagated.
In Eq.~\eqref{eq:3st_update},
the states $\Op\sigma^{\old}_k$ are backward-propagated with the
pulse of the previous iteration ('old'), whereas the states
$\Op\rho^{\new}_k$ are forward-propagated with the updated
pulse ('new'). The derivative with respect to the field is given by
the commutator
\begin{equation}
\frac{\partial \mathcal{L}\left(\Op\rho\right)}{\partial \epsilon}
= -i \left[\frac{\partial \Op H}{\partial \epsilon}, \Op{\rho} \right]
\end{equation}
and has to be evaluated for the `new' field and the states $\Op\rho$ propagated
under the `new' field. For a complex control, which
occurs for example when using the rotating wave approximation (RWA),
Eq.~\eqref{eq:3st_update} holds for both the real and the imaginary part
of $\epsilon(t)$.

The value of the optimization functional in Eq.~(\ref{eq:3st_functional}) depends on
the number and the specific choice of initial states as well as the choice of
weights. It is therefore not suitable to compare the convergence behavior
between different sets of states. Instead, we employ the average gate
fidelity as defined in Eq.~\eqref{eq:Favg_evaluation}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example I: Diagonal gates}
\label{sec:3st_phasegate}

It is quite common that a two-qubit
Hamiltonian allows only for diagonal gates, such as a controlled
phasegate. A prominent example are non-interacting
qubit carriers that interact only when excited into an auxiliary state
where they accumulate a non-local phase~\cite{JakschPRL00}.
Neutral trapped atoms with long-range interaction in a Rydberg state, discussed
in chapter~\ref{chap:robust}, present a physical implementation of this
setting~\cite{JakschPRL00,SaffmanRMP2010}.
We consider here the same system as in chapter~\ref{chap:robust}, albeit in
a slightly different parameter regime.
\begin{table}[tb]
  \centering
 \begin{tabular}{lr}
  \toprule
  single-photon detuning $\Delta_1$                 & \SI{600}{MHz} \\
  two-photon detuning $\Delta_2$                    &             0 \\
  excitation energy  $E_1$                          & \SI{6.8}{GHz} \\
  Rabi frequencies  $\Omega_R$, $\Omega_B$          & \SI{300}{MHz} \\
  interaction energy  $U$                           & \SI{50}{MHz} \\
  lifetime $\tau = 1/\gamma$ & \SI{25}{ns} \\
  \bottomrule
 \end{tabular}
  \caption{Parameters of the Hamiltonian, Eq.~\eqref{eq:ryd3_H},
    for implementing a controlled phasegate with two rubidium
    atoms.}
  \label{tab:ryd3_params}
\end{table}
The parameters correspond to optically trapped rubidium atoms (as opposed to
cesium atoms in chapter~\ref{chap:robust})
and are summarized in Table~\ref{tab:ryd3_params}.
As before, the excitation to the Rydberg state proceeds by a near-resonant
two-photon process via an intermediary state.
\begin{figure}[tb] % FIG 01
  \centering
  \includegraphics{ryd3_levels}
  \caption{Atomic levels for two-photon near-resonant excitation to a
    Rydberg state.}
  \label{fig:ryd3_levels}
\end{figure}
As shown in
Fig.~\ref{fig:ryd3_levels}, the transition $\Ket{0} \rightarrow \Ket{i}$ now
corresponds to a red laser frequency, whereas $\Ket{i} \rightarrow \Ket{r}$ is
a blue frequency, in contrast to Fig.~\ref{fig:RydRobust_1q_levels}. The
gate is implemented for non-individually addressable atoms, and outside of the
Rydberg blockade regime~\cite{JakschPRL00}, cf.~the discussion in
chapter~\ref{chap:robust}.  The Hamiltonian and the equation of motion is given
by Eqs.~(\ref{eq:Rydberg_H_1q}--\ref{eq:dissipator_rydberg}).

\begin{figure}[tb] % FIG 02
  \centering
 \includegraphics{ryd3_favg}
 \caption{Optimizing a controlled phasegate for two trapped neutral
   atoms that are excited to a Rydberg state. The convergence is shown
   as the gate error, $1-F_{\avg}$, over OCT iterations, using  the full basis of
   16 states (solid black lines), as well as a reduced set of three
   states (red dashed lines) and a reduced set of two states (green
   dotted and orange solid line). The
   calculations employ equal weights of all states, except for those shown in
   orange where $w_2 / w_3 = 10$.  The top and middle panels show
   optimizations without
   any dissipation; the middle panel shows a calculation with the same
   parameters as the top panel except for the guess pulse which is
   badly chosen. The optimization shown in the bottom panel
   takes into account spontaneous emission from the intermediate state, with
   a lifetime of $\tau = 25\,$ns. The gate duration is $T=50\,$ns for the top and
   middle panels, and $T=75\,$ns for the bottom panel. The number of iterations
   and the reached gate error differ significantly in all three
   situations, cf.\ the different x- and y-axes scales.
 }
  \label{fig:ryd3_favg}
\end{figure}
Figure~\ref{fig:ryd3_favg} shows the gate error of the
controlled phasegate versus iteration of the optimization algorithm when
using a full basis, i.e., 16 states, or using three, respectively two,
states in
Eq.~\eqref{eq:3st_control_Ryd}.
The minimum number of states in this
example is two since the Hamiltonian admits only diagonal gates, i.e.,
only phase errors and norm conservation within the logical subspace have to be
checked. Therefore, $\Op{\rho}_1$ in Eq.~(\ref{eq:3st_rho1}) can be omitted, and the two
remaining states are $\Op{\rho}_2$ (phase errors) and $\Op{\rho}_3$ (norm conservation) of
Eqs.~(\ref{eq:3st_rho2},~\ref{eq:3st_rho3}).
The relative weights $w_2$ and $w_3$ in Eq.~\eqref{eq:3st_functional} can
be modified to emphasize one of  the two aspects.
Figure~\ref{fig:ryd3_favg} therefore also compares two
states with equal and unequal weights in Eq.~\eqref{eq:3st_functional},
cf.\ green dotted and orange solid lines. The fastest convergence was obtained
for $w_2 / w_3 = 10$.
The panels from top to bottom show the optimization without any dissipation,
starting from a well-chosen guess pulse; an optimization starting with a bad
guess pulse of insufficient fluence; and an optimization taking into account
spontaneous decay from the intermediate level.
As the main observation, Fig.~\ref{fig:ryd3_favg}
clearly demonstrates that only two states are sufficient to optimize a
quantum gate for a Hamiltonian of this kind.
The optimization for coherent time evolution (top panel), shows that
while the use of three states converges to gate errors as small as
those obtained with the full
basis, the convergence rate is only about half that of the full basis.
This is due to two factors: (i) For the optimization with three states,
there is no bound on the distance between the value
$J_T$ and the gate error, such that
the path in the optimization landscape  may be less
direct until an asymptotic value is reached. Since without dissipation, there is
no limit to the gate error, the convergence of $J_T$ and that of
$1-F_{\avg}$ stay on different trajectories.
(ii) The reduced sets of states are constructed specifically
to take into account decoherence. In particular, the third state
contributes significantly less information that is relevant for
reaching the optimization target than the second state.
The convergence can be improved dramatically by weighting the three states
according to the relevance of the information they carry. In this
respect, the use of only two initial
states can be seen as choosing $w_1 = 0$. Taking $w_2 > w_3$
addresses the issue of $\Op\rho_3$ contributing less to the optimization.
Choosing proper weights allows for ensuring the convergence of
optimization with a reduced set of
states to be as fast as the optimization using the full basis.

The importance of choosing weights appropriate to the optimization problem
becomes even more evident when the optimization starts from a bad guess pulse of
insufficient fluence, as shown in the center panel of
Fig.~\ref{fig:ryd3_favg}. The features observed in
Fig.~\ref{fig:ryd3_favg} are typical: The
plateau near the beginning corresponds to the optimization increasing
the intensity of the pulse
without any significant improvement in the gate error, before converging
quickly once the pulse is sufficiently intense. The end of the plateau
can be significantly influenced by the
choice of weights, cf.\ solid orange and dotted green curves in the
middle panel of Fig.~\ref{fig:ryd3_favg}.
Remarkably, the optimal choice of using two properly weighted
initial states outperforms the use of the full basis. This might be explained by the
fact that each of the three states in the reduced set has a specific physical
role to play in the optimization, and this role can be emphasized by choice of
the weight. In contrast, all states in the full basis fulfill the
same role in the optimization, and thus there is no way in which different
weights on individual states would improve the convergence.

One should point out that even in the cases where the use of two or three states
shows a slower convergence than that of the full basis, they still outperform
the full basis in terms of numerical resources. Since both CPU time and the
required memory scale linearly with the number of initial states in the
optimization, using only two states compared to 16 has a 1:8 advantage, which
more than offsets the factor of two in the convergence rate in the
middle panel of Fig.~\ref{fig:ryd3_favg}.

Naturally, without the presence of decoherence, there is no reason to perform
the optimization in Liouville space. Therefore, the results shown here only
serve to illustrate the general convergence behavior of a reduced set of initial
states. The more relevant case of non-coherent dynamics is shown in the bottom
panel of Fig.~\ref{fig:ryd3_favg}. The presence of decoherence implies the
existence of an asymptotic bound on the gate error. This
constraint on the optimization landscape (together with the further constraint
that only diagonal gates are reachable) ensures that all sets of reduced states
converge at a similar rate, once the asymptotic region is approached. We expect
that all choices reach the same asymptotic value; which choice yields the best
fidelity after a specific number of iterations cannot be predicted in general.
Factoring in all necessary resources, optimization using two states with unequal
weights dramatically outperforms optimization
using the full basis in this example.

\begin{figure}[tbp] % FIG 03
  \centering
  \includegraphics{ryd3_nodiss_pulses}
  \caption{The optimized pulses $\Omega_{B,R}(t)$ for the blue and red laser
    cf.\ Fig~\ref{fig:ryd3_levels}, resulting from optimization using two
    states with unequal weights without spontaneous decay
    (corresponding to the orange
    solid line in the top panel of Fig.~\ref{fig:ryd3_favg}). The pulse
    amplitudes are shown in the top panel, the complex phase in the
    center panel, and the pulse spectrum in the bottom panel.  The guess
    pulse, indicated by the black dotted line in the top panel, is
    identical for both the red and the blue laser.  In the spectrum,
    frequency 0 corresponds to the carrier frequencies of the laser pulses.
  }
  \label{fig:ryd3_nodiss_pulses}
\end{figure}
The optimized pulse and spectrum in the case of coherent dynamics is presented in
Fig.~\ref{fig:ryd3_nodiss_pulses}. The result shown here is obtained from the
optimization using two initial states with unequal weights. However, the pulse is
indistinguishable from the one obtained using the full basis, consistent with
the identical convergence behavior for the two sets in the upper panel of
Fig.~\ref{fig:ryd3_favg}. The optimized pulses only show relatively small
amplitude modulations compared to the guess pulse (dotted line). These
modulations appear as small side-peaks in the spectrum. In the time interval in
which there is a significant pulse amplitude, the complex phase only deviates by
about $\frac{\pi}{10}$ from zero. This phase evolution is
reflected in the asymmetry of the spectrum for the red and the blue pulse
(bottom panel). The spectrum nicely illustrates the
mechanism of control: while each spectrum by itself is asymmetric, the
red pulse showing negative frequencies, the blue pulse showing positive
frequencies, the sum of both pulses is again symmetric, i.e., positive and
negative frequencies cancel out. This means that the combination of both pulses
is two-photon resonant with the transition $\Ket{0} \rightarrow \Ket{r}$,
providing multiple pathways for the same transition whose interference might be
exploited by the optimization.

\begin{figure}[tbp] % FIG 04
  \centering
  \includegraphics{ryd3_nodiss_popdyn}
  \caption{Population dynamics under the pulse shown in
           Fig.~\ref{fig:ryd3_nodiss_pulses}, for the logical basis states
           $\Ket{01}$ (top) and $\Ket{00}$ (bottom). The intermediate population
           (''int'') is integrated over all levels with decay, i.e., $\Ket{0i}$,
           $\Ket{i0}$, $\Ket{ii}$, $\Ket{ir}$, and $\Ket{ri}$.
  }
  \label{fig:ryd3_nodiss_popdyn}
\end{figure}
The population dynamics induced by the optimized pulses are shown in
Fig.~\ref{fig:ryd3_nodiss_popdyn}. The two-photon resonance of the pulse
expresses itself in a direct Rabi cycling between $\Ket{0}$ and
$\Ket{r}$ on the left qubit in the propagation of $\Ket{01}$ (top panel). The
population shows roughly a $4\pi$ Rabi flip due to the relatively high pulse
intensity. The nearly 25\% of the population in the intermediate states in the
propagation of $\Ket{00}$ (bottom panel) is due to the fact that the decay from
these levels was not included in the optimization, and thus the optimization
algorithm makes no attempt at suppressing population in these states.

\begin{figure}[tbp] % FIG 05
  \centering
  \includegraphics{ryd3_diss_pulses}
  \caption{The optimized pulses resulting from optimization using two weighted
           states and including spontaneous decay (orange
           solid line in Fig.~\ref{fig:ryd3_favg}, bottom panel), using
           the same conventions as Fig.~\ref{fig:ryd3_nodiss_pulses}.
  }
  \label{fig:ryd3_diss_pulses}
\end{figure}
For the optimization with dissipation, the optimized pulse and pulse
spectrum is shown in Fig.~\ref{fig:ryd3_diss_pulses}. The characteristics of
the pulses are quite different compared to the coherent case. The red pulse
remains close to the single Gaussian peak of the guess pulse, except for
being slightly narrower. The blue pulse has a more complex structure. It is
overall broader than the red pulse and consists of three distinctive features:
an initial peak that overlaps but precedes the red pulse, followed by some
amplitude oscillations in the center of the pulse, and lastly another
peak symmetric to the first, thus following the red laser pulse, with some
overlap.
For both pulses, the complex phase, shown in the center panel, is close to zero
when there is significant pulse amplitude. In the spectrum (bottom panel), the
overall narrowing and broadening of the red and blue pulse, respectively, is
reflected in a broadening and narrowing of the central peak in the spectrum. The
amplitude modulations on the blue pulse appear as side-lobes in the spectrum.

The initial and final peak of the blue pulse, together with the red pulse are
reminiscent of the counter-intuitive pulse scheme of STIRAP, with the blue laser
acting as the ``Stokes'' pulse and the red laser as ``pump''.
\begin{figure}[tbp] % FIG 06
  \centering
  \includegraphics{ryd3_diss_popdyn}
  \caption{Dissipative population dynamics under the pulse shown in
           Fig.~\ref{fig:ryd3_diss_pulses}, for the initial states
           $\Op\rho(0) = \Ket{01}\!\Bra{01}$ (top) and
           $\Op\rho(0) = \Ket{00}\!\Bra{00}$ (bottom).
           The intermediate population
           (''int'') is integrated over all levels with  decay, i.e.\
           $\Ket{0i}$, $\Ket{i0}$, $\Ket{ii}$, $\Ket{ir}$, and $\Ket{ri}$.
  }
  \label{fig:ryd3_diss_popdyn}
\end{figure}
The STIRAP-like behavior appears also in the population dynamics, shown
in Fig.~\ref{fig:ryd3_diss_popdyn}, as a population inversion between level
$\Ket{0}$ and $\Ket{r}$, \emph{without} any population in the intermediate
decaying state. The amplitude modulations in the central region of both pulses
then induce some additional dynamics, generating the entanglement needed for the
gate.
Note that the pulse duration for the dissipative process ($T = \SI{75}{ns}$) is longer
than that of the coherent process ($T = \SI{50}{ns}$). This is necessary to allow for
an adiabatic time evolution that is essential to the STIRAP-like behavior.
Overall, the decaying intermediate state population (red lines in
Fig.~\ref{fig:ryd3_diss_popdyn}) is almost completely suppressed,
which is in contrast to the optimization not taking into account
the dissipation, cf.\ the red lines in Fig.~\ref{fig:ryd3_nodiss_popdyn}.
Both Figs.~\ref{fig:ryd3_nodiss_popdyn} and~\ref{fig:ryd3_diss_popdyn}
show a significant population of the  $\Ket{rr}$ state. This is not
surprising since the parameters of Table~\ref{tab:ryd3_params} are
not in the regime of the Rydberg blockade~\cite{JakschPRL00,SaffmanRMP2010}.

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example II: Non-diagonal gates}
\label{sec:3st_nondiag_gate}

\begin{table}[tb]
  \centering
 \begin{tabular}{lr}
  \toprule
  qubit frequency  $\omega_1$          & \SI{4.3796}{GHz} \\
  qubit frequency  $\omega_2$          & \SI{4.6137}{GHz} \\
  drive frequency  $\omega_d$          & \SI{4.4985}{GHz} \\
  \midrule
  anharmonicity    $\alpha_1$          & \SI{-239.3}{MHz} \\
  anharmonicity    $\alpha_2$          & \SI{-242.8}{MHz} \\
  \midrule
  effective qubit-qubit coupling $J$   & \SI{-2.3}{MHz}   \\
  \midrule
  qubit 1 decay time $T_1$             & \SI{38.0}{\micro\second} \\
  qubit 2 decay time $T_1$             & \SI{32.0}{\micro\second} \\
  \midrule
  qubit 1 dephasing time $T^{*}_2$     & \SI{29.5}{\micro\second} \\
  qubit 2 dephasing time $T^{*}_2$     & \SI{16.0}{\micro\second} \\
  \bottomrule
 \end{tabular}
  \caption{Parameters of the transmon Hamiltonian,
    Eq.~\eqref{eq:tm3_H}, and Liouvillian, Eq.~\eqref{eq:tm3_L},
    taken from Ref.~\cite{PolettoPRL12}.}
  \label{tab:tm3_params}
\end{table}
Superconducting qubits represent a physical realization of a quantum
processor where the Hamiltonian admits both diagonal and non-diagonal
entangling gates. In fact, there exist superconducting
architectures that admit several two-qubit
gates simultaneously~\cite{ChowPRL11,PolettoPRL12}.
We consider here the example of two transmon
qubits coupled via a shared transmission line resonator. In the dispersive
limit, the interaction of each qubit with the resonator leads to an effective
coupling $J$ between the two qubits, and the cavity can be integrated
out~\cite{PolettoPRL12}. The resulting Hamiltonian reads,
cf.~Eq~\eqref{eq:PE_H2T},
\begin{equation}
\begin{split}
  \Op{H}
  &
  =
    \sum_{i=1,2} \left(
        \left( \omega_i + \frac{\alpha_i}{2}\right)
        \Op{b}_i^{\dagger} \Op{b}_i
        - \frac{\alpha_i}{2} \left( \Op{b}_i^{\dagger} \Op{b}_i \right)^2
    \right)
  + \\ \qquad &
  + J^{\eff} \left( \Op{b}_1^\dagger \Op{b}_2
                  + \Op{b}_1 \Op{b}_2^\dagger
            \right)
  + \Omega(t) \left( \Op{b}_1 + \Op{b}_1^\dagger
                    + \Op{b}_2 + \Op{b}_2^\dagger \right)
\end{split}
\label{eq:tm3_H}
\end{equation}
where $\Op{b}_{1,2}$, $\Op{b}_{1,2}^{\dagger}$ are the ladder operators for the
first and second qubit, $\omega_{1,2}$ and $\alpha_{1,2}$ represent
the frequency and anharmonicity, $J$ is the effective
qubit-qubit-interaction, and $\Omega(t)$ and $\omega_d$ are amplitude
and frequency of the drive, respectively
The two most relevant dissipation channels are energy relaxation and pure
dephasing of the qubits, described by the decay rate $\gamma = 1 / T_1$ and
dephasing rate $\gamma_{\phi} = 1 / T_2^{*}$ for each qubit. The
corresponding dissipator reads
\begin{equation}
  \label{eq:tm3_L}
  \mathcal L_D(\Op\rho)
  = \sum_{q=1,2} \left(
    \gamma_q \sum_{i=1}^{N-1} i D\left[\Ket{i-1}\!\Bra{i}_q\right] \Op\rho
    +
      \gamma_{\phi, q} \sum_{i=0}^{N-1}
       i^2 D\left[\Ket{i}\!\Bra{i}_q\right]
      \Op\rho
    \right)\,,
\end{equation}
with
\begin{equation}
  D\left[\Op{A} \right] \Op{\rho}
  = \Op{A} \Op{\rho} \Op{A}^{\dagger}
    - \frac{1}{2} \left(
      \Op{A}^{\dagger} \Op{A} \Op{\rho}
      + \Op{\rho} \Op{A}^{\dagger} \Op{A}
    \right)
\end{equation}
and each qubit, $q = 1,2$, truncated at level $N$.
The parameters of the coupled transmon qubits are summarized in
Table~\ref{tab:tm3_params}. We employ a
RWA, centered at the drive frequency $\omega_d$.

\begin{figure}[tb] % FIG 07
  \centering
 \includegraphics{tm3_fulldiss_favg}
 \caption{Optimizing a \sqrtISWAP{} gate for two transmons in the
   presence of energy relaxation and pure dephasing (with the rates
   given in Table~\ref{tab:tm3_params}): Convergence
   for five choices of sets of initial states, as described in the text. The gate
   duration is $T = \SI{400}{ns}$. The panels from top to bottom show the
   gate error over the number of iterations; the
   gate error over the number of state propagations, indicative of the required
   CPU time; a zoom on the initial phase of the optimization; and a zoom on the
   asymptotic convergence (panels c and d both using a linear scale). The number
   of propagations (x-axis in panels b-d) is a linear rescaling of the number of
   OCT iterations (x-axis in panel a), with 2 propagations per iteration and
   state, i.e.\ the lines of panel a are rescaled differently depending
   on the respective number of states. Since all panels only show different
   views on the same data, the line colors and styles are the same in all of
   them.}
 \label{fig:tm3_fulldiss_favg}
\end{figure}
The Hamiltonian in Eq.~(\ref{eq:tm3_H}) can generate a large number of
entangling two-qubit gates; we find \sqrtISWAP{} to be a fast converging
non-diagonal perfect entangler, and thus choose
\begin{equation}
  \Op{O}%_{\sqrtISWAP}
  = \begin{pmatrix}
    1 &                  0   &                  0 & 0 \\
    0 & \frac{1}{\sqrt{2}}   & \frac{\ii}{\sqrt{2}} & 0 \\
    0 & \frac{\ii}{\sqrt{2}} & \frac{1}{\sqrt{2}} & 0 \\
    0 &                  0   &                  0 & 1
  \end{pmatrix}
  \label{eq:sqrt_iswap}
\end{equation}
as the optimization target.
Figure~\ref{fig:tm3_fulldiss_favg} shows the convergence behavior for
several choices of initial states: the 16 canonical states of the full
basis of Liouville space; the three states given in
Eq.~(\ref{eq:3st_rhos}) with equal weight and
with $w_1 / w_2 = w_1 / w_3 = 20$; a set of 5 states consisting of $\Op\rho_1$
expanded into four pure states, cf. Eq.~\eqref{eq:3st_rho1_dp1}
plus $\Op\rho_2$ of Eq.~\eqref{eq:3st_rho2}; and lastly a set of eight
states, cf. Eqs.~\eqref{eq:3st_rho1_dp1}
and~\eqref{eq:3st_rho2_2d},
consisting of the expansion of $\Op\rho_1$ and the four pure
states of a mutually unbiased basis, as explained in
Section~\ref{sec:3st_oct}.
As seen in the top panel, all choices %of sets of initial states
show good convergence. A plateau corresponding to a slowing of
convergence is observed only for the three
states with equal weights. But even in this case, the same asymptotic
value for the gate error is obtained as for the other choices, see also
Fig.~\ref{fig:tm3_fulldiss_favg}(d).
The advantage of employing the reduced sets of
states in the optimization functional, Eq.~\eqref{eq:3st_functional},
becomes most apparent in Fig.~\ref{fig:tm3_fulldiss_favg}(b)
which shows the gate error over the number of state
propagations. Since optimization requires two propagations per
iteration and state, i.e., the
backward and forward propagation in Eq.~\eqref{eq:3st_control}, the number
of state propagations corresponds directly to the CPU time that is
required to obtain a given
fidelity. Figure~\ref{fig:tm3_fulldiss_favg}(c) and (d)
shows a zoom on the same data, once for the initial phase
of the optimization and once for the asymptotic behavior. All reduced sets
except for the three states with equal weights perform better than the
full set during the
initial phase.  Also, for this specific optimization problem, all reduced sets
reach a slightly better asymptotic value than the full set, although we
expect that ultimately all curves will converge to the same value.
Figure~\ref{fig:tm3_fulldiss_favg} suggests that
the reduced sets have a significant
advantage in reaching a good fidelity with a given amount of resources, especially
since in practice, an optimization is usually stopped near the beginning of the
asymptotic regime. Indeed, the full set shows an advantage only in the
intermediate regime between gate errors of 10 and 1 percent, and only over the
sets of three states. The choice of 5 or 8 states outperforms the full set in
all cases.
One should note that the savings in computational resources due to the
use of a reduced set of
states also extends to the amount of memory required, which is proportional to
the number of states. Since in the optimization algorithm, propagated states
over the entire time grid need to be stored, these savings can be very
substantial.

For the three states with equal weights the gate error
shows a non-monotonic behavior in the upper left corner of
Fig.~\ref{fig:tm3_fulldiss_favg}(c). This is due to the
optimization functional, Eq.~\eqref{eq:3st_functional}, not being
equivalent to the gate error $F_{\avg}$,
Eq.~\eqref{eq:Favg_evaluation}. Specifically, for a set of three states, no
bound on the distance between $J_T$  and $1-F_{\avg}$ can be
derived~\cite{ReichKochPRA13}. Thus,
the gate error might increase even though $J_T$
decreases. In fact, the behavior of $J_T$ is fully monotonic as
expected (data not shown).  With an increasing number of states in the chosen set, the
value of the optimization functional is more closely connected to the
gate fidelity; and for 5 and 8 states numerical, respectively
analytical, bounds can be found~\cite{ReichKochPRA13, HofmannPRL05}.
For this reason, we expect the sets of 5 and 8 states to show
a faster convergence than the 3 states, when measured in OCT
iterations, although not
necessarily in CPU time. This expectation is confirmed by
Fig.~\ref{fig:tm3_fulldiss_favg}.
The weak correspondence between the optimization functional and
the gate error for three states is most likely also the reason for the
plateau observed for the red dashed line in
Fig.~\ref{fig:tm3_fulldiss_favg}(a) and (b).
However, the use of three states can still be a good choice since
weighting the states properly improves the
convergence significantly. The weights have to be chosen empirically,
but the choice can be guided by physical intuition.  The
three states are responsible for ensuring that the realized gate is diagonal in
the correct basis, that the relative phases match the target once the correct
basis has been found, and that the gate is unitary on the logical subspace,
respectively. The weights should reflect which of these requirements
is most difficult to realize.
In the present example this is finding the correct basis in which the gate is
diagonal. Therefore the choice of $w_1/w_2 = w_1/w_3 = 20$ gave the best
convergence rate. This is in contrast to the optimization of the Rydberg gate in
Section~\ref{sec:3st_phasegate}, in which the gate was already known to be diagonal,
and the first state could be left out of the optimization entirely. Generally,
using the set of three states with equal weights is not recommended.

Comparing Fig.~\ref{fig:tm3_fulldiss_favg} with the bottom panel of
Fig.~\ref{fig:ryd3_favg} for the Rydberg gate shows that the different
choices of basis sets show a slightly wider range of the convergence rate.
This can be attributed to the fact that, for the Rydberg gate, the
optimization landscape is severely constrained since only
diagonal gates can be reached. In contrast, the transmon Hamiltonian
can generate both diagonal
and non-diagonal gates, resulting in a more complex optimization landscape.
Different choices of initial states can thus take more strongly varying pathways.


\begin{figure}[tb] % FIG 08
  \centering
 \includegraphics{tm3_weakdiss_favg}
 \caption{Optimizing a \sqrtISWAP{} gate for two transmons with weak
   dissipation, using
   decay and dephasing times increased by a factor of 10 compared to
   Fig.~\ref{fig:tm3_fulldiss_favg} (with all quantities and
   labels as defined in Fig.~\ref{fig:tm3_fulldiss_favg}). The gate duration
   is $T=\SI{400}{ns}$.  The weaker dissipation results in an asymptotic gate error of
   approximately \num{7.5e-4} compared to \num{7.5e-3} in
   Fig.~\ref{fig:tm3_fulldiss_favg}, cf.\ the y-axis scales in
   both figures.
   }
 \label{fig:tm3_weakdiss_favg}
\end{figure}
Figure~\ref{fig:tm3_weakdiss_favg} shows the optimization of
a \sqrtISWAP{} gate for two transmons in the
case of weak dissipation, where the decay and dephasing times from
Table~\ref{tab:tm3_params} have been increased by a factor of 10. A comparison of
Fig.~\ref{fig:tm3_weakdiss_favg}(a) with
Fig.~\ref{fig:tm3_fulldiss_favg}(a) shows that the
convergence
behavior is essentially the same except for the value of the asymptote. We find
an asymptotic gate error of approximately \num{7e-3} with full
dissipation, \num{7e-4} with weak dissipation, and no asymptote without
dissipation (data not shown). The value of the asymptote is logarithmically
proportional to the decay and dephasing rates. This is as expected
since the pulse duration is kept constant at \SI{400}{ns} and the gate
fidelity is solely limited by
dissipation. Our claim that the dissipation only affects the asymptotic
convergence is supported by a comparison of the initial convergence
in Figs.~\ref{fig:tm3_fulldiss_favg}(c)
and~\ref{fig:tm3_weakdiss_favg}(c),
which remarkably are completely identical.
Furthermore, the crossing between the black solid and red dot-dashed lines for
the full basis and the three states with unequal weights near 1000 propagations
and that between the blue dotted and orange dash-dash-dotted lines for the sets
of 5, respectively 8, states near
1300 propagations in Fig.~\ref{fig:tm3_weakdiss_favg}(d) can
also be seen in Fig.~\ref{fig:tm3_fulldiss_favg}(d).
There are however some slight differences in the asymptotically reached values,
in that the choice of 3 states (with both equal and unequal weights) reaches a slightly
smaller gate error than in the case of full dissipation. Again, we expect that
ultimately, all curves will converge to the same value. Which set of states
reaches the best gate error at a specific point near the beginning of the
asymptotic region seems to depend on the slope of the convergence curve as the
limit is approached. This can depend on any number of factors
including, e.g., the choice
of $\lambda_a$ in Eq.~(\ref{eq:3st_J}). Again, empirically, the reduced sets of
states show a significant numerical advantage over the full basis also
for weak dissipation.

\begin{figure}[tbp] % FIG 09
  \centering
  \includegraphics{tm3_fulldiss_pulses}
  \caption{Shape and spectrum of an optimized pulse, from optimization with
    3 weighted states, with strong dissipation. The panels from top to bottom show the
    amplitude, complex phase, and spectrum of the optimized
    pulse $\Omega(t)$.  The spectrum is shown in the rotating frame, with
    zero corresponding to the driving frequency $w_d$ of the field. The
    transition frequencies from the logical subspace are indicated by
    vertical dashed lines.
    These are $\Delta_1 = w_1 - w_d = \SI{-118.88}{MHz}$ and
    $\Delta_1 - \alpha_1 = \SI{-358.18}{MHz}$ in red for the left qubit, and
    $\Delta_2 = w_2 - w_d = \SI{115.20}{MHz}$ and
    $\Delta_2 - \alpha_2 = \SI{-127.58}{MHz}$ in blue for the right qubit.
    The central peak in the spectrum has been cut off to show the
    relevant side-peaks, and would extend to a value of approximately
    10.0.  For all quantities, the values for the guess pulse are shown
    as a dotted line.
           % from run t3r20101
           % spectra have been scaled with factor 2.0e9
  }
  \label{fig:tm3_fulldiss_pulses}
\end{figure}
\begin{figure}[tb] % FIG 10
  \centering
  \includegraphics{tm3_fulldiss_popdyn01}
  \includegraphics{tm3_fulldiss_popdyn11}
  \caption{Population dynamics for
          $\Op\rho(t=0) = \Ket{01}\!\Bra{01}$ (a) and
          $\Op\rho(t=0) = \Ket{11}\!\Bra{11}$ (b) under the
          pulse shown in Fig.~\ref{fig:tm3_fulldiss_pulses}. For each of the two
          propagated states, the expectation value of the right qubit excitation
          quantum number $j$ is shown in the top panel, with the standard
          deviation in gray, the expectation value for the corresponding quantum
          number $i$ for the left qubit is shown in the center panel, and the
          population dynamics for all the logical subspace states is shown in
          the bottom panel (colored lines), along with the total population in
          the logical subspace (black line).}
  \label{fig:tm3_fulldiss_popdyn}
\end{figure}
As an example, the optimized pulse obtained using a set of  three
states with unequal weights, taking into account the full dissipation,
is presented in
Fig.~\ref{fig:tm3_fulldiss_pulses}, along with the pulse spectrum. The population
dynamics that this pulse induces when propagating the logical basis states
$\Op{\rho}(t=0) = \Ket{01}\!\Bra{01}$ and  $\Op{\rho}(t=0) = \Ket{11}\!\Bra{11}$
is shown in Fig.~\ref{fig:tm3_fulldiss_popdyn}.
As can be seen in the top panel of Fig.~\ref{fig:tm3_fulldiss_pulses}, the optimized
pulse shows small oscillations around the guess peak amplitude of \SI{35}{MHz}. The complex
phase, shown in the middle panel, stays relatively close to zero, indicating
that the optimization employs mainly amplitude modulation. The pulse
amplitude is roughly time-symmetric. The pulse spectrum shown in the
bottom panel of Fig.~\ref{fig:tm3_fulldiss_pulses}
relates easily to the pulse shape. The strongest frequency component remains the
driving frequency of the guess pulse (zero in the spectrum). The small
oscillations in the pulse shape are approximately \SI{8}{ns} apart, corresponding to
a frequency of \SI{+-125}{MHz}, which is present in the spectrum. There are peaks
with exponentially decaying amplitude in the spectrum at multiples of these
values. The width of the central peak is due to the \SI{20}{ns} switch-on and
switch-off time of the pulse, and is unchanged from the guess pulse. The
fact that there is not a single, but a double peak around \SI{+-125}{MHz}
corresponds the slow beats in the pulse shape.  The slight asymmetry of the
spectrum is caused by the complex phase of the optimized pulse.

The spectrum of the optimized pulse is very instructive in understanding the
population dynamics in Fig.~\ref{fig:tm3_fulldiss_popdyn}. The most relevant
transition frequencies from the logical subspace are indicated by vertical lines
in the spectrum in the lower panel of Fig.~\ref{fig:tm3_fulldiss_pulses}. Clearly,
the peaks around \SI{125}{MHz} are nearly resonant with the excitation of the
left and right qubit, and the excitation to level $\Ket{2}$ of the right qubit.
There is no significant component in the spectrum that could excite to the level
$\Ket{2}$ of the left qubit.
Consequently, in the population dynamics of both the $\Ket{01}\!\Bra{01}$ and
$\Ket{11}\!\Bra{11}$ state, the right qubit (top panel) leaves the logical
subspace (expectation value $\langle j\rangle>1.0$) to a much more
significant extent than the
left qubit (middle panel). This behavior is slightly more pronounced for
$\Ket{11}\!\Bra{11}$, which is the only state for which the total subspace
population (gray curve in bottom panel) drops below 80\% for a significant
amount of time.
The fact that for all logical basis states, most of the dynamics
occurs within the logical
subspace is due to the presence of decoherence, where higher levels have
faster decay and faster dephasing due to a stronger coupling to the cavity. In an
optimization without dissipation (data not shown), the optimized dynamics would
generally veer farther outside the logical subspace. Lastly, the population
dynamics show the expected behavior for the \sqrtISWAP{} gate: the $\Ket{01}$
state ends up in a coherent superposition between $\Ket{01}$ and $\Ket{10}$,
whereas $\Ket{11}$ returns to its original state at the end of the gate.



% The significant reduction in computational resources that we report
% here opens the door for a large-scale, systematic investigation of the
% fundamental limits of high-fidelity quantum gates in the presence of
% decoherence. Our approach is not tied to a specific decoherence
% model. It therefore allows to explore, using optimal control theory,
% settings for extended Hilbert spaces and beyond Markovian master
% equations, where a quantum system's complexity
% may possibly be exploited for control.

